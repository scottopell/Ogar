{"version":3,"sources":["gamemodes/Teams.ts"],"names":["Teams","Teams.constructor","Teams.fuzzColorComponent","Teams.getTeamColor","Teams.onPlayerSpawn","Teams.onServerInit","Teams.onPlayerInit","Teams.onCellAdd","Teams.onCellRemove","Teams.onCellMove","Teams.updateLB"],"mappings":"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","file":"gamemodes/Teams.js","sourcesContent":["import Mode from './Mode';\nimport PlayerTracker from '../PlayerTracker'\nimport {Color} from '../HelperDefs/index';\n\nexport default class Teams extends Mode{\n  colorFuzziness: number;\n  colors: Color[];\n  teamAmount: number;\n  nodes: any[];\n\n  constructor(){\n    super();\n\n    this.ID = 1;\n    this.name = \"Teams\";\n    this.decayMod = 1.5;\n    this.packetLB = 50;\n    this.haveTeams = true;\n    this.colorFuzziness = 32;\n\n    // Special\n    // Amount of teams. Having more than 3 teams will cause the leaderboard to work incorrectly (client issue).\n    this.teamAmount = 3;\n    // Make sure you add extra colors here if you wish to increase the team amount [Default colors are: Red, Green, Blue]\n    this.colors = [\n      {'r': 223, 'g': 0, 'b': 0},\n      {'r': 0, 'g': 223, 'b': 0},\n      {'r': 0, 'g': 0, 'b': 223},\n    ];\n    this.nodes = []; // Teams\n  }\n\n  //Gamemode Specific Functions\n\n  fuzzColorComponent(component) {\n    component += Math.random() * this.colorFuzziness >> 0;\n    return component;\n  }\n\n  getTeamColor(team) {\n    var color = this.colors[team];\n    return {\n      r: this.fuzzColorComponent(color.r),\n      b: this.fuzzColorComponent(color.b),\n      g: this.fuzzColorComponent(color.g)\n    };\n  }\n\n  // Override\n\n  onPlayerSpawn(gameServer,player) {\n    // Random color based on team\n    player.color = this.getTeamColor(player.team);\n    // Spawn player\n    gameServer.spawnPlayer(player);\n  }\n\n  onServerInit(gameServer) {\n    // Set up teams\n    for (var i = 0; i < this.teamAmount; i++) {\n      this.nodes[i] = [];\n    }\n\n    // migrate current players to team mode\n    for (var i = 0; i < gameServer.clients.length; i++) {\n      var client = gameServer.clients[i].playerTracker;\n      this.onPlayerInit(client);\n      client.color = this.getTeamColor(client.team);\n      for (var j = 0; j < client.cells.length; j++) {\n        var cell = client.cells[j];\n        cell.setColor(client.color);\n        this.nodes[client.team].push(cell);\n      }\n    }\n  }\n\n  onPlayerInit(player) {\n    // Get random team\n    player.team = Math.floor(Math.random() * this.teamAmount);\n  }\n\n  onCellAdd(cell) {\n    // Add to team list\n    this.nodes[cell.owner.getTeam()].push(cell);\n  }\n\n  onCellRemove(cell) {\n    // Remove from team list\n    var index = this.nodes[cell.owner.getTeam()].indexOf(cell);\n    if (index != -1) {\n      this.nodes[cell.owner.getTeam()].splice(index, 1);\n    }\n  }\n\n  onCellMove(x1,y1,cell) {\n    var team = cell.owner.getTeam();\n    var r = cell.getSize();\n\n    // Find team\n    for (var i = 0; i < cell.owner.visibleNodes.length;i++) {\n      // Only collide with player cells\n      var check = cell.owner.visibleNodes[i];\n\n      if ((check.getType() != 0) || (cell.owner == check.owner)){\n        continue;\n      }\n\n      // Collision with teammates\n      if (check.owner.getTeam() == team) {\n        // Check if in collision range\n        var collisionDist = check.getSize() + r; // Minimum distance between the 2 cells\n        if (!cell.simpleCollide(x1,y1,check, collisionDist)) {\n          // Skip\n          continue;\n        }\n\n        // First collision check passed... now more precise checking\n        var dist = cell.getDist(cell.position.x,cell.position.y,check.position.x,check.position.y);\n\n        // Calculations\n        if (dist < collisionDist) { // Collided\n          // The moving cell pushes the colliding cell\n          var newDeltaY = check.position.y - y1;\n          var newDeltaX = check.position.x - x1;\n          var newAngle = Math.atan2(newDeltaX,newDeltaY);\n\n          var move = collisionDist - dist;\n\n          check.position.x = check.position.x + ( move * Math.sin(newAngle) ) >> 0;\n          check.position.y = check.position.y + ( move * Math.cos(newAngle) ) >> 0;\n        }\n      }\n    }\n  }\n\n  updateLB(gameServer) {\n    var total = 0;\n    var teamMass = [];\n    // Get mass\n    for (var i = 0; i < this.teamAmount; i++) {\n      // Set starting mass\n      teamMass[i] = 0;\n\n      // Loop through cells\n      for (var j = 0; j < this.nodes[i].length;j++) {\n        var cell = this.nodes[i][j];\n\n        if (!cell) {\n          continue;\n        }\n\n        teamMass[i] += cell.mass;\n        total += cell.mass;\n      }\n    }\n    // Calc percentage\n    for (var i = 0; i < this.teamAmount; i++) {\n      // No players\n      if (total <= 0) {\n        continue;\n      }\n\n      gameServer.leaderboard[i] = teamMass[i]/total;\n    }\n  }\n\n}\n"],"sourceRoot":"/source/"}
"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj["default"] = obj; return newObj; } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var _packetIndex = require('./packet/index');

var Packet = _interopRequireWildcard(_packetIndex);

function stobuf(buf) {
    var length = buf.length;
    var arrayBuf = new ArrayBuffer(length);
    var view = new Uint8Array(arrayBuf);
    for (var i = 0; i < length; i++) {
        view[i] = buf[i];
    }
    return view.buffer;
}

var PacketHandler = (function () {
    function PacketHandler(gameServer, socket) {
        _classCallCheck(this, PacketHandler);

        this.gameServer = gameServer;
        this.socket = socket;
        this.protocol = 0;
        this.pressQ = false;
        this.pressW = false;
        this.pressSpace = false;
    }

    _createClass(PacketHandler, [{
        key: "handleMessage",
        value: function handleMessage(message) {
            if (message.length == 0) {
                return;
            }
            var buffer = stobuf(message);
            var view = new DataView(buffer);
            var packetId = view.getUint8(0);
            switch (packetId) {
                case 0:
                    if ((view.byteLength + 1) % 2 == 1) {
                        break;
                    }
                    var nick = "";
                    var maxLen = this.gameServer.config.playerMaxNickLength * 2;
                    for (var i = 1; i < view.byteLength && i <= maxLen; i += 2) {
                        var charCode = view.getUint16(i, true);
                        if (charCode == 0) {
                            break;
                        }
                        nick += String.fromCharCode(charCode);
                    }
                    this.setNickname(nick);
                    break;
                case 1:
                    if (this.socket.playerTracker.cells.length <= 0) {
                        this.gameServer.switchSpectator(this.socket.playerTracker);
                        this.socket.playerTracker.spectate = true;
                    }
                    break;
                case 16:
                    if (view.byteLength == 13) {
                        var client = this.socket.playerTracker;
                        client.mouse.x = view.getInt32(1, true);
                        client.mouse.y = view.getInt32(5, true);
                    }
                    break;
                case 17:
                    this.pressSpace = true;
                    break;
                case 18:
                    this.pressQ = true;
                    break;
                case 19:
                    break;
                case 21:
                    this.pressW = true;
                    break;
                case 255:
                    if (view.byteLength == 5) {
                        this.protocol = view.getUint32(1, true);
                        var c = this.gameServer.config;
                        this.socket.sendPacket(new Packet.SetBorder(c.borderLeft, c.borderRight, c.borderTop, c.borderBottom));
                    }
                    break;
                default:
                    break;
            }
        }
    }, {
        key: "setNickname",
        value: function setNickname(newNick) {
            var client = this.socket.playerTracker;
            if (client.cells.length < 1) {
                client.setName(newNick);
                this.gameServer.gameMode.onPlayerSpawn(this.gameServer, client);
                client.spectate = false;
            }
        }
    }]);

    return PacketHandler;
})();

exports["default"] = PacketHandler;
module.exports = exports["default"];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlBhY2tldEhhbmRsZXIudHMiXSwibmFtZXMiOlsic3RvYnVmIiwiUGFja2V0SGFuZGxlciIsIlBhY2tldEhhbmRsZXIuY29uc3RydWN0b3IiLCJQYWNrZXRIYW5kbGVyLmhhbmRsZU1lc3NhZ2UiLCJQYWNrZXRIYW5kbGVyLnNldE5pY2tuYW1lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7MkJBQXdCLGdCQUFnQjs7SUFBNUIsTUFBTTs7QUFJbEIsU0FBQSxNQUFBLENBQWdCLEdBQUcsRUFBQTtBQUNqQkEsUUFBSUEsTUFBTUEsR0FBR0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7QUFDeEJBLFFBQUlBLFFBQVFBLEdBQUdBLElBQUlBLFdBQVdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO0FBQ3ZDQSxRQUFJQSxJQUFJQSxHQUFHQSxJQUFJQSxVQUFVQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQTtBQUVwQ0EsU0FBS0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUE7QUFDL0JBLFlBQUlBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO0tBQ2xCQTtBQUVEQSxXQUFPQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTtDQUNwQkE7O0lBRUQsYUFBQTtBQVNFQyxhQVRGLGFBQUEsQ0FTY0EsVUFBc0JBLEVBQUVBLE1BQU1BLEVBQUFBOzhCQVQ1QyxhQUFBOztBQVVJQyxZQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxVQUFVQSxDQUFDQTtBQUM3QkEsWUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsTUFBTUEsQ0FBQ0E7QUFFckJBLFlBQUlBLENBQUNBLFFBQVFBLEdBQUdBLENBQUNBLENBQUNBO0FBRWxCQSxZQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxLQUFLQSxDQUFDQTtBQUNwQkEsWUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0E7QUFDcEJBLFlBQUlBLENBQUNBLFVBQVVBLEdBQUdBLEtBQUtBLENBQUNBO0tBQ3pCQTs7aUJBbEJILGFBQUE7O2VBb0JlRCx1QkFBQ0EsT0FBT0EsRUFBQUE7QUFHbkJFLGdCQUFJQSxPQUFPQSxDQUFDQSxNQUFNQSxJQUFJQSxDQUFDQSxFQUFFQTtBQUN2QkEsdUJBQU9BO2FBQ1JBO0FBRURBLGdCQUFJQSxNQUFNQSxHQUFHQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtBQUM3QkEsZ0JBQUlBLElBQUlBLEdBQUdBLElBQUlBLFFBQVFBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO0FBQ2hDQSxnQkFBSUEsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7QUFFaENBLG9CQUFRQSxRQUFRQTtBQUNkQSxxQkFBS0EsQ0FBQ0E7QUFFSkEsd0JBQUlBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLENBQUNBLENBQUFBLEdBQUlBLENBQUNBLElBQUlBLENBQUNBLEVBQUVBO0FBQ2xDQSw4QkFBTUE7cUJBQ1BBO0FBR0RBLHdCQUFJQSxJQUFJQSxHQUFHQSxFQUFFQSxDQUFDQTtBQUVkQSx3QkFBSUEsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsbUJBQW1CQSxHQUFHQSxDQUFDQSxDQUFDQTtBQUM1REEseUJBQUtBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFVBQVVBLElBQUlBLENBQUNBLElBQUlBLE1BQU1BLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLEVBQUVBO0FBQzFEQSw0QkFBSUEsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7QUFDdkNBLDRCQUFJQSxRQUFRQSxJQUFJQSxDQUFDQSxFQUFFQTtBQUNqQkEsa0NBQU1BO3lCQUNQQTtBQUVEQSw0QkFBSUEsSUFBSUEsTUFBTUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7cUJBQ3ZDQTtBQUNEQSx3QkFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7QUFDdkJBLDBCQUFNQTtBQUFBQSxBQUNSQSxxQkFBS0EsQ0FBQ0E7QUFFSkEsd0JBQUlBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLGFBQWFBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLElBQUlBLENBQUNBLEVBQUVBO0FBRS9DQSw0QkFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0E7QUFDM0RBLDRCQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxhQUFhQSxDQUFDQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQTtxQkFDM0NBO0FBQ0RBLDBCQUFNQTtBQUFBQSxBQUNSQSxxQkFBS0EsRUFBRUE7QUFFTEEsd0JBQUlBLElBQUlBLENBQUNBLFVBQVVBLElBQUlBLEVBQUVBLEVBQUVBO0FBQ3pCQSw0QkFBSUEsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsYUFBYUEsQ0FBQ0E7QUFDdkNBLDhCQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtBQUN4Q0EsOEJBQU1BLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO3FCQUN6Q0E7QUFDREEsMEJBQU1BO0FBQUFBLEFBQ1JBLHFCQUFLQSxFQUFFQTtBQUVMQSx3QkFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsSUFBSUEsQ0FBQ0E7QUFDdkJBLDBCQUFNQTtBQUFBQSxBQUNSQSxxQkFBS0EsRUFBRUE7QUFFTEEsd0JBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBO0FBQ25CQSwwQkFBTUE7QUFBQUEsQUFDUkEscUJBQUtBLEVBQUVBO0FBRUxBLDBCQUFNQTtBQUFBQSxBQUNSQSxxQkFBS0EsRUFBRUE7QUFFTEEsd0JBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBO0FBQ25CQSwwQkFBTUE7QUFBQUEsQUFDUkEscUJBQUtBLEdBQUdBO0FBRU5BLHdCQUFJQSxJQUFJQSxDQUFDQSxVQUFVQSxJQUFJQSxDQUFDQSxFQUFFQTtBQUN4QkEsNEJBQUlBLENBQUNBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO0FBRXhDQSw0QkFBSUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7QUFDL0JBLDRCQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxVQUFVQSxDQUFDQSxJQUFJQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQSxVQUFVQSxFQUFFQSxDQUFDQSxDQUFDQSxXQUFXQSxFQUFFQSxDQUFDQSxDQUFDQSxTQUFTQSxFQUFFQSxDQUFDQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQSxDQUFDQTtxQkFDeEdBO0FBQ0RBLDBCQUFNQTtBQUFBQSxBQUNSQTtBQUNFQSwwQkFBTUE7QUFBQUEsYUFDVEE7U0FDRkE7OztlQUVVRixxQkFBQ0EsT0FBT0EsRUFBQUE7QUFDakJHLGdCQUFJQSxNQUFNQSxHQUFrQkEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsYUFBYUEsQ0FBQ0E7QUFDdERBLGdCQUFJQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxFQUFFQTtBQUUzQkEsc0JBQU1BLENBQUNBLE9BQU9BLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO0FBR3hCQSxvQkFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsRUFBRUEsTUFBTUEsQ0FBQ0EsQ0FBQ0E7QUFHaEVBLHNCQUFNQSxDQUFDQSxRQUFRQSxHQUFHQSxLQUFLQSxDQUFDQTthQUN6QkE7U0FDRkE7OztXQTdHSCxhQUFBOzs7cUJBQUEsYUFBQSIsImZpbGUiOiJQYWNrZXRIYW5kbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUGFja2V0IGZyb20gJy4vcGFja2V0L2luZGV4JztcbmltcG9ydCBHYW1lU2VydmVyIGZyb20gJy4vR2FtZVNlcnZlcic7XG5pbXBvcnQgUGxheWVyVHJhY2tlciBmcm9tICcuL1BsYXllclRyYWNrZXInO1xuXG5mdW5jdGlvbiBzdG9idWYoYnVmKSB7XG4gIHZhciBsZW5ndGggPSBidWYubGVuZ3RoO1xuICB2YXIgYXJyYXlCdWYgPSBuZXcgQXJyYXlCdWZmZXIobGVuZ3RoKTtcbiAgdmFyIHZpZXcgPSBuZXcgVWludDhBcnJheShhcnJheUJ1Zik7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgIHZpZXdbaV0gPSBidWZbaV07XG4gIH1cblxuICByZXR1cm4gdmlldy5idWZmZXI7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBhY2tldEhhbmRsZXJ7XG4gIGdhbWVTZXJ2ZXI6IEdhbWVTZXJ2ZXI7XG4gIHNvY2tldDogYW55O1xuICBwcm90b2NvbDogbnVtYmVyO1xuXG4gIHByZXNzUTogYm9vbGVhbjtcbiAgcHJlc3NXOiBib29sZWFuO1xuICBwcmVzc1NwYWNlOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKGdhbWVTZXJ2ZXI6IEdhbWVTZXJ2ZXIsIHNvY2tldCkge1xuICAgIHRoaXMuZ2FtZVNlcnZlciA9IGdhbWVTZXJ2ZXI7XG4gICAgdGhpcy5zb2NrZXQgPSBzb2NrZXQ7XG4gICAgLy8gRGV0ZWN0IHByb3RvY29sIHZlcnNpb24gLSB3ZSBjYW4gZG8gc29tZXRoaW5nIGFib3V0IGl0IGxhdGVyXG4gICAgdGhpcy5wcm90b2NvbCA9IDA7XG5cbiAgICB0aGlzLnByZXNzUSA9IGZhbHNlO1xuICAgIHRoaXMucHJlc3NXID0gZmFsc2U7XG4gICAgdGhpcy5wcmVzc1NwYWNlID0gZmFsc2U7XG4gIH1cblxuICBoYW5kbGVNZXNzYWdlKG1lc3NhZ2UpIHtcblxuICAgIC8vIERpc2NhcmQgZW1wdHkgbWVzc2FnZXNcbiAgICBpZiAobWVzc2FnZS5sZW5ndGggPT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBidWZmZXIgPSBzdG9idWYobWVzc2FnZSk7XG4gICAgdmFyIHZpZXcgPSBuZXcgRGF0YVZpZXcoYnVmZmVyKTtcbiAgICB2YXIgcGFja2V0SWQgPSB2aWV3LmdldFVpbnQ4KDApO1xuXG4gICAgc3dpdGNoIChwYWNrZXRJZCkge1xuICAgICAgY2FzZSAwOlxuICAgICAgICAvLyBDaGVjayBmb3IgaW52YWxpZCBwYWNrZXRzXG4gICAgICAgIGlmICgodmlldy5ieXRlTGVuZ3RoICsgMSkgJSAyID09IDEpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNldCBOaWNrbmFtZVxuICAgICAgICB2YXIgbmljayA9IFwiXCI7XG4gICAgICAgIC8vIDIgYnl0ZXMgcGVyIGNoYXJcbiAgICAgICAgdmFyIG1heExlbiA9IHRoaXMuZ2FtZVNlcnZlci5jb25maWcucGxheWVyTWF4Tmlja0xlbmd0aCAqIDI7XG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdmlldy5ieXRlTGVuZ3RoICYmIGkgPD0gbWF4TGVuOyBpICs9IDIpIHtcbiAgICAgICAgICB2YXIgY2hhckNvZGUgPSB2aWV3LmdldFVpbnQxNihpLCB0cnVlKTtcbiAgICAgICAgICBpZiAoY2hhckNvZGUgPT0gMCkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbmljayArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoYXJDb2RlKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldE5pY2tuYW1lKG5pY2spO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgLy8gU3BlY3RhdGUgbW9kZVxuICAgICAgICBpZiAodGhpcy5zb2NrZXQucGxheWVyVHJhY2tlci5jZWxscy5sZW5ndGggPD0gMCkge1xuICAgICAgICAgIC8vIE1ha2Ugc3VyZSBjbGllbnQgaGFzIG5vIGNlbGxzXG4gICAgICAgICAgdGhpcy5nYW1lU2VydmVyLnN3aXRjaFNwZWN0YXRvcih0aGlzLnNvY2tldC5wbGF5ZXJUcmFja2VyKTtcbiAgICAgICAgICB0aGlzLnNvY2tldC5wbGF5ZXJUcmFja2VyLnNwZWN0YXRlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMTY6XG4gICAgICAgIC8vIFNldCBUYXJnZXRcbiAgICAgICAgaWYgKHZpZXcuYnl0ZUxlbmd0aCA9PSAxMykge1xuICAgICAgICAgIHZhciBjbGllbnQgPSB0aGlzLnNvY2tldC5wbGF5ZXJUcmFja2VyO1xuICAgICAgICAgIGNsaWVudC5tb3VzZS54ID0gdmlldy5nZXRJbnQzMigxLCB0cnVlKTtcbiAgICAgICAgICBjbGllbnQubW91c2UueSA9IHZpZXcuZ2V0SW50MzIoNSwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDE3OlxuICAgICAgICAvLyBTcGFjZSBQcmVzcyAtIFNwbGl0IGNlbGxcbiAgICAgICAgdGhpcy5wcmVzc1NwYWNlID0gdHJ1ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDE4OlxuICAgICAgICAvLyBRIEtleSBQcmVzc2VkXG4gICAgICAgIHRoaXMucHJlc3NRID0gdHJ1ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDE5OlxuICAgICAgICAvLyBRIEtleSBSZWxlYXNlZFxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjE6XG4gICAgICAgIC8vIFcgUHJlc3MgLSBFamVjdCBtYXNzXG4gICAgICAgIHRoaXMucHJlc3NXID0gdHJ1ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI1NTpcbiAgICAgICAgLy8gQ29ubmVjdGlvbiBTdGFydCBcbiAgICAgICAgaWYgKHZpZXcuYnl0ZUxlbmd0aCA9PSA1KSB7XG4gICAgICAgICAgdGhpcy5wcm90b2NvbCA9IHZpZXcuZ2V0VWludDMyKDEsIHRydWUpO1xuICAgICAgICAgIC8vIFNlbmQgU2V0Qm9yZGVyIHBhY2tldCBmaXJzdFxuICAgICAgICAgIHZhciBjID0gdGhpcy5nYW1lU2VydmVyLmNvbmZpZztcbiAgICAgICAgICB0aGlzLnNvY2tldC5zZW5kUGFja2V0KG5ldyBQYWNrZXQuU2V0Qm9yZGVyKGMuYm9yZGVyTGVmdCwgYy5ib3JkZXJSaWdodCwgYy5ib3JkZXJUb3AsIGMuYm9yZGVyQm90dG9tKSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBicmVhaztcbiAgICB9XG4gIH07XG5cbiAgc2V0Tmlja25hbWUobmV3Tmljaykge1xuICAgIHZhciBjbGllbnQ6IFBsYXllclRyYWNrZXIgPSB0aGlzLnNvY2tldC5wbGF5ZXJUcmFja2VyO1xuICAgIGlmIChjbGllbnQuY2VsbHMubGVuZ3RoIDwgMSkge1xuICAgICAgLy8gU2V0IG5hbWUgZmlyc3RcbiAgICAgIGNsaWVudC5zZXROYW1lKG5ld05pY2spOyBcblxuICAgICAgLy8gSWYgY2xpZW50IGhhcyBubyBjZWxscy4uLiB0aGVuIHNwYXduIGEgcGxheWVyXG4gICAgICB0aGlzLmdhbWVTZXJ2ZXIuZ2FtZU1vZGUub25QbGF5ZXJTcGF3bih0aGlzLmdhbWVTZXJ2ZXIsIGNsaWVudCk7XG5cbiAgICAgIC8vIFR1cm4gb2ZmIHNwZWN0YXRlIG1vZGVcbiAgICAgIGNsaWVudC5zcGVjdGF0ZSA9IGZhbHNlO1xuICAgIH1cbiAgfTtcbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
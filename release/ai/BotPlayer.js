'use strict';

Object.defineProperty(exports, '__esModule', {
    value: true
});

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _PlayerTracker2 = require('../PlayerTracker');

var _PlayerTracker3 = _interopRequireDefault(_PlayerTracker2);

var BotPlayer = (function (_PlayerTracker) {
    _inherits(BotPlayer, _PlayerTracker);

    function BotPlayer(gameServer, socket) {
        _classCallCheck(this, BotPlayer);

        _get(Object.getPrototypeOf(BotPlayer.prototype), 'constructor', this).call(this, gameServer, socket);
        this.gameState = 0;
        this.path = [];
        this.predators = [];
        this.threats = [];
        this.prey = [];
        this.food = [];
        this.foodImportant = [];
        this.virus = [];
        this.juke = false;
        this.target;
        this.targetVirus;
        this.ejectMass = 0;
        this.oldPos = { x: 0, y: 0 };
    }

    _createClass(BotPlayer, [{
        key: 'getLowestCell',
        value: function getLowestCell() {
            if (this.cells.length <= 0) {
                return null;
            }
            var lowest = this.cells[0];
            for (var i = 1; i < this.cells.length; i++) {
                if (lowest.mass > this.cells[i].mass) {
                    lowest = this.cells[i];
                }
            }
            return lowest;
        }
    }, {
        key: 'updateSightRange',
        value: function updateSightRange() {
            var range = 1000;
            if (this.cells[0]) {
                range += this.cells[0].getSize() * 2.5;
            }
            this.sightRangeX = range;
            this.sightRangeY = range;
        }
    }, {
        key: 'update',
        value: function update() {
            for (var i = 0; i < this.nodeDestroyQueue.length; i++) {
                var index = this.visibleNodes.indexOf(this.nodeDestroyQueue[i]);
                if (index > -1) {
                    this.visibleNodes.splice(index, 1);
                }
            }
            if (this.tickViewBox <= 0 && this.gameServer.run) {
                this.visibleNodes = this.calcViewBox();
                this.tickViewBox = 10;
            } else {
                this.tickViewBox--;
                return;
            }
            if (this.cells.length <= 0) {
                this.gameServer.gameMode.onPlayerSpawn(this.gameServer, this);
                if (this.cells.length == 0) {
                    this.socket.close();
                    return;
                }
            }
            var cell = this.getLowestCell();
            var r = cell.getSize();
            this.clearLists();
            var ignoreMass = Math.min(cell.mass / 10, 150);
            for (var _i in this.visibleNodes) {
                var check = this.visibleNodes[_i];
                if (!check || cell.owner == check.owner) {
                    continue;
                }
                var t = check.getType();
                switch (t) {
                    case 0:
                        if (this.gameServer.gameMode.haveTeams) {
                            if (check.owner.team == this.team) {
                                continue;
                            }
                        }
                        if (cell.mass > check.mass * 1.25) {
                            this.prey.push(check);
                        } else if (check.mass > cell.mass * 1.25) {
                            var dist = this.getDist(cell, check) - (r + check.getSize());
                            if (dist < 300) {
                                this.predators.push(check);
                                if (this.cells.length == 1 && dist < 0) {
                                    this.juke = true;
                                }
                            }
                            this.threats.push(check);
                        } else {
                            this.threats.push(check);
                        }
                        break;
                    case 1:
                        this.food.push(check);
                        break;
                    case 2:
                        this.virus.push(check);
                        break;
                    case 3:
                        if (cell.mass > 20) {
                            this.food.push(check);
                        }
                        break;
                    default:
                        break;
                }
            }
            var newState = this.getState(cell);
            if (newState != this.gameState && newState != 4) {
                this.target = null;
            }
            this.gameState = newState;
            this.decide(cell);
            this.nodeDestroyQueue = [];
        }
    }, {
        key: 'clearLists',
        value: function clearLists() {
            this.predators = [];
            this.threats = [];
            this.prey = [];
            this.food = [];
            this.virus = [];
            this.juke = false;
        }
    }, {
        key: 'getState',
        value: function getState(cell) {
            if (this.gameState == 4) {
                return 4;
            }
            if (this.predators.length <= 0) {
                if (this.prey.length > 0) {
                    return 3;
                } else if (this.food.length > 0) {
                    return 1;
                }
            } else if (this.threats.length > 0) {
                if (this.cells.length == 1 && cell.mass > 180) {
                    var t = this.getBiggest(this.threats);
                    var tl = this.findNearbyVirus(t, 500, this.virus);
                    if (tl != false) {
                        this.target = t;
                        this.targetVirus = tl;
                        return 4;
                    }
                } else {
                    return 2;
                }
            }
            return 0;
        }
    }, {
        key: 'decide',
        value: function decide(cell) {
            switch (this.gameState) {
                case 0:
                    if (this.centerPos.x == this.mouse.x && this.centerPos.y == this.mouse.y) {
                        var index = Math.floor(Math.random() * this.gameServer.nodes.length);
                        var randomNode = this.gameServer.nodes[index];
                        var pos = { x: 0, y: 0 };
                        if (randomNode.getType() == 3 || randomNode.getType() == 1) {
                            pos.x = randomNode.position.x;
                            pos.y = randomNode.position.y;
                        } else {
                            pos = this.gameServer.getRandomPosition();
                        }
                        this.mouse = { x: pos.x, y: pos.y };
                    }
                    break;
                case 1:
                    if (!this.target || this.visibleNodes.indexOf(this.target) == -1) {
                        this.target = this.findNearest(cell, this.food);
                        this.mouse = { x: this.target.position.x, y: this.target.position.y };
                    }
                    break;
                case 2:
                    var avoid = this.combineVectors(this.predators);
                    var deltaY = avoid.y - cell.position.y;
                    var deltaX = avoid.x - cell.position.x;
                    var angle = Math.atan2(deltaX, deltaY);
                    if (angle > Math.PI) {
                        angle -= Math.PI;
                    } else {
                        angle += Math.PI;
                    }
                    var x1 = cell.position.x + 500 * Math.sin(angle);
                    var y1 = cell.position.y + 500 * Math.cos(angle);
                    this.mouse = { x: x1, y: y1 };
                    if (cell.mass < 250) {
                        cell.mass += 1;
                    }
                    if (this.juke) {
                        this.gameServer.splitCells(this);
                    }
                    break;
                case 3:
                    if (!this.target || cell.mass < this.target.mass * 1.25 || this.visibleNodes.indexOf(this.target) == -1) {
                        this.target = this.getRandom(this.prey);
                    }
                    this.mouse = { x: this.target.position.x, y: this.target.position.y };
                    var massReq = 1.25 * (this.target.mass * 2);
                    if (cell.mass > massReq && this.cells.length == 1) {
                        var splitDist = 4 * (cell.getSpeed() * 5) + cell.getSize() * 1.75;
                        var distToTarget = this.getAccDist(cell, this.target);
                        if (splitDist >= distToTarget) {
                            if (this.threats.length > 0 && this.getBiggest(this.threats).mass > 1.25 * (cell.mass / 2)) {
                                break;
                            }
                            this.gameServer.splitCells(this);
                        }
                    }
                    break;
                case 4:
                    if (!this.target || !this.targetVirus || this.cells.length !== 1 || this.visibleNodes.indexOf(this.target) == -1 || this.visibleNodes.indexOf(this.targetVirus) == -1) {
                        this.gameState = 0;
                        this.target = null;
                        break;
                    }
                    var dist = this.getDist(this.targetVirus, this.target) - (this.target.getSize() + 100);
                    if (dist > 500) {
                        this.gameState = 0;
                        this.target = null;
                        break;
                    }
                    var angle = this.getAngle(this.target, this.targetVirus);
                    var reversed = this.reverseAngle(angle);
                    var ourAngle = this.getAngle(cell, this.targetVirus);
                    if (ourAngle <= reversed + .25 && ourAngle >= reversed - .25) {
                        this.mouse = { x: this.targetVirus.position.x, y: this.targetVirus.position.y };
                        for (var v = 0; v < 7; v++) {
                            this.gameServer.ejectMass(this);
                        }
                        this.mouse = { x: cell.position.x, y: cell.position.y };
                        this.gameState = 0;
                        this.target = null;
                    } else {
                        var _r = cell.getSize();
                        var _x1 = this.targetVirus.position.x + (350 + _r) * Math.sin(reversed);
                        var _y1 = this.targetVirus.position.y + (350 + _r) * Math.cos(reversed);
                        this.mouse = { x: _x1, y: _y1 };
                    }
                    break;
                default:
                    this.gameState = 0;
                    break;
            }
            if (this.cells.length > 1) {
                var r = 0;
                for (var i in this.cells) {
                    if (this.cells[i].recombineTicks == 0) {
                        r++;
                    }
                }
                if (r >= 2) {
                    this.mouse.x = this.centerPos.x;
                    this.mouse.y = this.centerPos.y;
                }
            }
        }
    }, {
        key: 'findNearest',
        value: function findNearest(cell, list) {
            /* TODO figure out what this.currentTarget is supposed to be and where it
             * is supposed to be set
            if (this.currentTarget) {
              // Do not check for food if target already exists
              return null;
            }
            */
            var shortest = list[0];
            var shortestDist = this.getDist(cell, shortest);
            for (var i = 1; i < list.length; i++) {
                var check = list[i];
                var dist = this.getDist(cell, check);
                if (shortestDist > dist) {
                    shortest = check;
                    shortestDist = dist;
                }
            }
            return shortest;
        }
    }, {
        key: 'getRandom',
        value: function getRandom(list) {
            var n = Math.floor(Math.random() * list.length);
            return list[n];
        }
    }, {
        key: 'combineVectors',
        value: function combineVectors(list) {
            var pos = { x: 0, y: 0 };
            var check;
            for (var i = 0; i < list.length; i++) {
                check = list[i];
                pos.x += check.position.x;
                pos.y += check.position.y;
            }
            pos.x = pos.x / list.length;
            pos.y = pos.y / list.length;
            return pos;
        }
    }, {
        key: 'getBiggest',
        value: function getBiggest(list) {
            var biggest = list[0];
            for (var i = 1; i < list.length; i++) {
                var check = list[i];
                if (check.mass > biggest.mass) {
                    biggest = check;
                }
            }
            return biggest;
        }
    }, {
        key: 'findNearbyVirus',
        value: function findNearbyVirus(cell, checkDist, list) {
            var r = cell.getSize() + 100;
            for (var i = 0; i < list.length; i++) {
                var check = list[i];
                var dist = this.getDist(cell, check) - r;
                if (checkDist > dist) {
                    return check;
                }
            }
            return false;
        }
    }, {
        key: 'getDist',
        value: function getDist(cell, check) {
            var xd = check.position.x - cell.position.x;
            xd = xd < 0 ? xd * -1 : xd;
            var yd = check.position.y - cell.position.y;
            yd = yd < 0 ? yd * -1 : yd;
            return xd + yd;
        }
    }, {
        key: 'getAccDist',
        value: function getAccDist(cell, check) {
            var xs = check.position.x - cell.position.x;
            xs = xs * xs;
            var ys = check.position.y - cell.position.y;
            ys = ys * ys;
            return Math.sqrt(xs + ys);
        }
    }, {
        key: 'getAngle',
        value: function getAngle(c1, c2) {
            var deltaY = c1.position.y - c2.position.y;
            var deltaX = c1.position.x - c2.position.x;
            return Math.atan2(deltaX, deltaY);
        }
    }, {
        key: 'reverseAngle',
        value: function reverseAngle(angle) {
            if (angle > Math.PI) {
                angle -= Math.PI;
            } else {
                angle += Math.PI;
            }
            return angle;
        }
    }]);

    return BotPlayer;
})(_PlayerTracker3['default']);

exports['default'] = BotPlayer;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFpL0JvdFBsYXllci50cyJdLCJuYW1lcyI6WyJCb3RQbGF5ZXIiLCJCb3RQbGF5ZXIuY29uc3RydWN0b3IiLCJCb3RQbGF5ZXIuZ2V0TG93ZXN0Q2VsbCIsIkJvdFBsYXllci51cGRhdGVTaWdodFJhbmdlIiwiQm90UGxheWVyLnVwZGF0ZSIsIkJvdFBsYXllci5jbGVhckxpc3RzIiwiQm90UGxheWVyLmdldFN0YXRlIiwiQm90UGxheWVyLmRlY2lkZSIsIkJvdFBsYXllci5maW5kTmVhcmVzdCIsIkJvdFBsYXllci5nZXRSYW5kb20iLCJCb3RQbGF5ZXIuY29tYmluZVZlY3RvcnMiLCJCb3RQbGF5ZXIuZ2V0QmlnZ2VzdCIsIkJvdFBsYXllci5maW5kTmVhcmJ5VmlydXMiLCJCb3RQbGF5ZXIuZ2V0RGlzdCIsIkJvdFBsYXllci5nZXRBY2NEaXN0IiwiQm90UGxheWVyLmdldEFuZ2xlIiwiQm90UGxheWVyLnJldmVyc2VBbmdsZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs4QkFBMEIsa0JBQWtCOzs7O0lBSTVDLFNBQUE7Y0FBQSxTQUFBOztBQTBCRUEsYUExQkYsU0FBQSxDQTBCY0EsVUFBc0JBLEVBQUVBLE1BQU1BLEVBQUFBOzhCQTFCNUMsU0FBQTs7QUEyQklDLG1DQTNCSixTQUFBLDZDQTJCVUEsVUFBVUEsRUFBRUEsTUFBTUEsRUFBRUE7QUFHMUJBLFlBQUlBLENBQUNBLFNBQVNBLEdBQUdBLENBQUNBLENBQUNBO0FBQ25CQSxZQUFJQSxDQUFDQSxJQUFJQSxHQUFHQSxFQUFFQSxDQUFDQTtBQUVmQSxZQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxFQUFFQSxDQUFDQTtBQUNwQkEsWUFBSUEsQ0FBQ0EsT0FBT0EsR0FBR0EsRUFBRUEsQ0FBQ0E7QUFDbEJBLFlBQUlBLENBQUNBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBO0FBQ2ZBLFlBQUlBLENBQUNBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBO0FBQ2ZBLFlBQUlBLENBQUNBLGFBQWFB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QUlBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLElBQUlBLElBQUlBLENBQUNBLElBQUlBLEVBQUVBO0FBQ2pDQSx5Q0FBU0E7NkJBQ1ZBO3lCQUNGQTtBQUdEQSw0QkFBSUEsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBSUEsS0FBS0EsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQUFBQ0EsRUFBRUE7QUFFbkNBLGdDQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTt5QkFDdkJBLE1BQU1BLElBQUlBLEtBQUtBLENBQUNBLElBQUlBLEdBQUlBLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLEFBQUNBLEVBQUVBO0FBRTFDQSxnQ0FBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsRUFBRUEsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQUEsQUFBQ0EsQ0FBQ0E7QUFDN0RBLGdDQUFJQSxJQUFJQSxHQUFHQSxHQUFHQSxFQUFFQTtBQUNkQSxvQ0FBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7QUFDM0JBLG9DQUFJQSxBQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxDQUFDQSxJQUFNQSxJQUFJQSxHQUFHQSxDQUFDQSxBQUFDQSxFQUFFQTtBQUMxQ0Esd0NBQUlBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO2lDQUNsQkE7NkJBQ0ZBO0FBQ0RBLGdDQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTt5QkFDMUJBLE1BQU1BO0FBQ0xBLGdDQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTt5QkFDMUJBO0FBQ0RBLDhCQUFNQTtBQUFBQSxBQUNSQSx5QkFBS0EsQ0FBQ0E7QUFDSkEsNEJB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QSxDQUFDQSxHQUFHQSxVQUFVQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQTt5QkFDL0JBLE1BQU1BO0FBRUxBLCtCQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxpQkFBaUJBLEVBQUVBLENBQUNBO3lCQUMzQ0E7QUFHREEsNEJBQUlBLENBQUNBLEtBQUtBLEdBQUdBLEVBQUNBLENBQUNBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBLEVBQUNBLENBQUNBO3FCQUNuQ0E7QUFDREEsMEJBQU1BO0FBQUFBLEFBQ1JBLHFCQUFLQSxDQUFDQTtBQUVKQSx3QkFBSUEsQUFBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsSUFBTUEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQUFBQ0EsRUFBRUE7QUFFcEVBLDRCQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxJQUFJQSxFQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtBQUUvQ0EsNEJBQUlBLENBQUNBLEtBQUtBLEdBQUdBLEVBQUNBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEVBQUNBLENBQUNBO3FCQUNyRUE7QUFDREEsMEJBQU1BO0FBQUFBLEFBQ1JBLHFCQUFLQSxDQUFDQTtBQUNKQSx3QkFBSUEsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0E7QUFJaERBLHdCQUFJQSxNQUFNQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQTtBQUN2Q0Esd0JBQUlBLE1BQU1BLEdBQUdBLEtBQUtBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBO0FBQ3ZDQSx3QkFBSUEsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsRUFBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7QUFHdENBLHdCQUFJQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxFQUFFQSxFQUFFQTtBQUNuQkEsNkJBQUtBLElBQUlBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBO3FCQUNsQkEsTUFBTUE7QUFDTEEsNkJBQUtBLElBQUlBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBO3FCQUNsQkE7QUFHREEsd0JBQUlBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEdBQUlBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEtBQUtBLENBQUNBLEFBQUNBLENBQUNBO0FBQ25EQSx3QkFBSUEsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsR0FBSUEsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQUFBQ0EsQ0FBQ0E7QUFFbkRBLHdCQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxFQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFDQSxDQUFDQTtBQUc1QkEsd0JBQUlBLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLEdBQUdBLEVBQUVBO0FBQ25CQSw0QkFBSUEsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7cUJBQ2hCQTtBQUVEQSx3QkFBSUEsSUFBSUEsQ0FBQ0EsSUFBSUEsRUFBRUE7QUFFYkEsNEJBQUlBLENBQUNBLFVBQVVBLENBQUNBLFVBQVVBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO3FCQUNsQ0E7QUFFREEsMEJBQU1BO0FBQUFBLEFBQ1JBLHFCQUFLQSxDQUFDQTtBQUNKQSx3QkFBSUEsQUFBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsSUFBTUEsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBSUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQUFBQ0EsQUFBQ0EsSUFBS0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQUFBQ0EsRUFBRUE7QUFDL0dBLDRCQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtxQkFDekNBO0FBSURBLHdCQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxFQUFDQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxFQUFDQSxDQUFDQTtBQUVwRUEsd0JBQUlBLE9BQU9BLEdBQUdBLElBQUlBLElBQUlBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUFBLEFBQUVBLENBQUNBO0FBRTdDQSx3QkFBSUEsQUFBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsT0FBT0EsSUFBTUEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsQ0FBQ0EsQUFBQ0EsRUFBRUE7QUFDckRBLDRCQUFJQSxTQUFTQSxHQUFHQSxBQUFDQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQSxRQUFRQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFBQSxBQUFDQSxHQUFLQSxJQUFJQSxDQUFDQSxPQUFPQSxFQUFFQSxHQUFHQSxJQUFJQSxBQUFDQSxDQUFDQTtBQUN0RUEsNEJBQUlBLFlBQVlBLEdBQUdBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLElBQUlBLEVBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO0FBRXJEQSw0QkFBSUEsU0FBU0EsSUFBSUEsWUFBWUEsRUFBRUE7QUFDN0JBLGdDQUFJQSxBQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxJQUFNQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxJQUFJQSxHQUFJQSxJQUFJQSxJQUFJQSxJQUFJQSxDQUFDQSxJQUFJQSxHQUFDQSxDQUFDQSxDQUFBQSxBQUFDQSxBQUFDQSxBQUFDQSxFQUFFQTtBQUU5RkEsc0NBQU1BOzZCQUNQQTtBQUVEQSxnQ0FBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7eUJBQ2xDQTtxQkFDRkE7QUFDREEsMEJBQU1BO0FBQUFBLEFBQ1JBLHFCQUFLQSxDQUFDQTtBQUNKQSx3QkFBT0EsQUFBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsSUFDWkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQUFBQ0EsSUFDbEJBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEtBQUtBLENBQUNBLEFBQUNBLElBQ3hCQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxBQUFDQSxJQUM3Q0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQUFBQ0EsRUFBRUE7QUFDMURBLDRCQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxDQUFDQSxDQUFDQTtBQUNuQkEsNEJBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBO0FBQ25CQSw4QkFBTUE7cUJBQ1BBO0FBR0RBLHdCQUFJQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxFQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxPQUFPQSxFQUFFQSxHQUFHQSxHQUFHQSxDQUFBQSxBQUFDQSxDQUFDQTtBQUN0RkEsd0JBQUlBLElBQUlBLEdBQUdBLEdBQUdBLEVBQUVBO0FBQ2RBLDRCQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxDQUFDQSxDQUFDQTtBQUNuQkEsNEJBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBO0FBQ25CQSw4QkFBTUE7cUJBQ1BBO0FBR0RBLHdCQUFJQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxFQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQTtBQUd4REEsd0JBQUlBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO0FBR3hDQSx3QkFBSUEsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsRUFBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FBQ0E7QUFHcERBLHdCQUFJQSxBQUFDQSxRQUFRQSxJQUFLQSxRQUFRQSxHQUFHQSxHQUFHQSxBQUFDQSxJQUFPQSxRQUFRQSxJQUFLQSxRQUFRQSxHQUFHQSxHQUFHQSxBQUFDQSxBQUFFQSxFQUFFQTtBQUV0RUEsNEJBQUlBLENBQUNBLEtBQUtBLEdBQUdBLEVBQUNBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEVBQUNBLENBQUNBO0FBRzlFQSw2QkFBS0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUE7QUFDMUJBLGdDQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxTQUFTQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTt5QkFDakNBO0FBR0RBLDRCQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxFQUFDQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxFQUFDQSxDQUFDQTtBQUd0REEsNEJBQUlBLENBQUNBLFNBQVNBLEdBQUdBLENBQUNBLENBQUNBO0FBQ25CQSw0QkFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0E7cUJBQ3BCQSxNQUFNQTtBQUVMQSw0QkFBSUEsRUFBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0E7QUFDdkJBLDRCQUFJQSxHQUFFQSxHQUFHQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxHQUFJQSxDQUFDQSxHQUFHQSxHQUFHQSxFQUFDQSxDQUFBQSxHQUFJQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxRQUFRQSxDQUFDQSxBQUFDQSxDQUFDQTtBQUN4RUEsNEJBQUlBLEdBQUVBLEdBQUdBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEdBQUlBLENBQUNBLEdBQUdBLEdBQUdBLEVBQUNBLENBQUFBLEdBQUlBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFFBQVFBLENBQUNBLEFBQUNBLENBQUNBO0FBQ3hFQSw0QkFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsRUFBQ0EsQ0FBQ0EsRUFBRUEsR0FBRUEsRUFBRUEsQ0FBQ0EsRUFBRUEsR0FBRUEsRUFBQ0EsQ0FBQ0E7cUJBQzdCQTtBQUdEQSwwQkFBTUE7QUFBQUEsQUFDUkE7QUFFRUEsd0JBQUlBLENBQUNBLFNBQVNBLEdBQUdBLENBQUNBLENBQUNBO0FBQ25CQSwwQkFBTUE7QUFBQUEsYUFDVEE7QUFHREEsZ0JBQUlBLElBQUlBLENBQUNBLEtBQUtBLENBQUNB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QUNBLFFBQVFBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBO0FBQzNDQSxnQkFBSUEsTUFBTUEsR0FBR0EsRUFBRUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7QUFDM0NBLG1CQUFPQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxFQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtTQUNsQ0E7OztlQUVXZixzQkFBQ0EsS0FBS0EsRUFBQUE7QUFDaEJnQixnQkFBSUEsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsRUFBRUEsRUFBRUE7QUFDbkJBLHFCQUFLQSxJQUFJQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQTthQUNsQkEsTUFBTUE7QUFDTEEscUJBQUtBLElBQUlBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBO2FBQ2xCQTtBQUNEQSxtQkFBT0EsS0FBS0EsQ0FBQ0E7U0FDZEE7OztXQXhmSCxTQUFBOzs7cUJBQUEsU0FBQSIsImZpbGUiOiJhaS9Cb3RQbGF5ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUGxheWVyVHJhY2tlciBmcm9tICcuLi9QbGF5ZXJUcmFja2VyJztcbmltcG9ydCBHYW1lU2VydmVyIGZyb20gJy4uL0dhbWVTZXJ2ZXInO1xuaW1wb3J0IHsgUG9zaXRpb24gfSBmcm9tICcuLi9IZWxwZXJEZWZzL2luZGV4JztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQm90UGxheWVyIGV4dGVuZHMgUGxheWVyVHJhY2tlcntcbiAgZ2FtZVN0YXRlOiBudW1iZXI7XG4gIHBhdGg6IGFueVtdO1xuXG4gIC8vIExpc3Qgb2YgY2VsbHMgdGhhdCBjYW4gZWF0IHRoaXMgYm90XG4gIHByZWRhdG9yczogYW55W107XG5cbiAgLy8gTGlzdCBvZiBjZWxscyB0aGF0IGNhbiBlYXQgdGhpcyBib3QgYnV0IGFyZSB0b28gZmFyIGF3YXlcbiAgdGhyZWF0czogYW55W107XG5cbiAgLy8gTGlzdCBvZiBjZWxscyB0aGF0IGNhbiBiZSBlYXRlbiBieSB0aGlzIGJvdFxuICBwcmV5OiBhbnlbXTtcblxuICAvLyBOb3QgdXNlZCAtIEJvdHMgd2lsbCBhdHRlbXB0IHRvIGVhdCB0aGlzIHJlZ2FyZGxlc3Mgb2YgbmVhcmJ5IHByZXkvcHJlZGF0b3JzXG4gIGZvb2Q6IGFueVtdO1xuXG4gIGZvb2RJbXBvcnRhbnQ6IGFueVtdO1xuICB2aXJ1czogYW55W107XG5cbiAganVrZTogYm9vbGVhbjtcbiAgdGFyZ2V0OiBhbnk7XG4gIC8vdmlydXM/XG4gIHRhcmdldFZpcnVzOiBhbnk7XG4gIGVqZWN0TWFzczogbnVtYmVyO1xuICBvbGRQb3M6IFBvc2l0aW9uO1xuXG4gIGNvbnN0cnVjdG9yKGdhbWVTZXJ2ZXI6IEdhbWVTZXJ2ZXIsIHNvY2tldCl7XG4gICAgc3VwZXIoZ2FtZVNlcnZlciwgc29ja2V0KTtcblxuICAgIC8vIEFJIG9ubHlcbiAgICB0aGlzLmdhbWVTdGF0ZSA9IDA7XG4gICAgdGhpcy5wYXRoID0gW107XG5cbiAgICB0aGlzLnByZWRhdG9ycyA9IFtdO1xuICAgIHRoaXMudGhyZWF0cyA9IFtdO1xuICAgIHRoaXMucHJleSA9IFtdO1xuICAgIHRoaXMuZm9vZCA9IFtdO1xuICAgIHRoaXMuZm9vZEltcG9ydGFudCA9IFtdO1xuICAgIHRoaXMudmlydXMgPSBbXTtcblxuICAgIHRoaXMuanVrZSA9IGZhbHNlO1xuXG4gICAgdGhpcy50YXJnZXQ7XG4gICAgdGhpcy50YXJnZXRWaXJ1czsgLy8gVmlydXMgdXNlZCB0byBzaG9vdCBpbnRvIHRoZSB0YXJnZXRcblxuICAgIHRoaXMuZWplY3RNYXNzID0gMDsgLy8gQW1vdW50IG9mIHRpbWVzIHRvIGVqZWN0IG1hc3NcbiAgICB0aGlzLm9sZFBvcyA9IHt4OiAwLCB5OjB9O1xuICB9XG5cbiAgLy8gRnVuY3Rpb25zXG5cbiAgZ2V0TG93ZXN0Q2VsbCgpIHtcbiAgICAvLyBHZXRzIHRoZSBjZWxsIHdpdGggdGhlIGxvd2VzdCBtYXNzXG4gICAgaWYgKHRoaXMuY2VsbHMubGVuZ3RoIDw9IDApIHtcbiAgICAgIHJldHVybiBudWxsOyAvLyBFcnJvciFcbiAgICB9XG5cbiAgICAvLyBTdGFydGluZyBjZWxsXG4gICAgdmFyIGxvd2VzdCA9IHRoaXMuY2VsbHNbMF07XG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCB0aGlzLmNlbGxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAobG93ZXN0Lm1hc3MgPiB0aGlzLmNlbGxzW2ldLm1hc3MpIHtcbiAgICAgICAgbG93ZXN0ID0gdGhpcy5jZWxsc1tpXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGxvd2VzdDtcbiAgfVxuXG4gIC8vIE92ZXJyaWRlXG5cbiAgdXBkYXRlU2lnaHRSYW5nZSgpIHsgLy8gRm9yIHZpZXcgZGlzdGFuY2VcbiAgICB2YXIgcmFuZ2UgPSAxMDAwOyAvLyBCYXNlIHNpZ2h0IHJhbmdlXG5cbiAgICBpZiAodGhpcy5jZWxsc1swXSkge1xuICAgICAgcmFuZ2UgKz0gdGhpcy5jZWxsc1swXS5nZXRTaXplKCkgKiAyLjU7XG4gICAgfVxuXG4gICAgdGhpcy5zaWdodFJhbmdlWCA9IHJhbmdlO1xuICAgIHRoaXMuc2lnaHRSYW5nZVkgPSByYW5nZTtcbiAgfVxuXG4gIC8vIE92ZXJyaWRlcyB0aGUgdXBkYXRlIGZ1bmN0aW9uIGZyb20gcGxheWVyIHRyYWNrZXJcbiAgdXBkYXRlKCkge1xuICAgIC8vIFJlbW92ZSBub2RlcyBmcm9tIHZpc2libGUgbm9kZXMgaWYgcG9zc2libGVcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubm9kZURlc3Ryb3lRdWV1ZS5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGluZGV4ID0gdGhpcy52aXNpYmxlTm9kZXMuaW5kZXhPZih0aGlzLm5vZGVEZXN0cm95UXVldWVbaV0pO1xuICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgdGhpcy52aXNpYmxlTm9kZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgZXZlcnkgNTAwIG1zXG4gICAgaWYgKCh0aGlzLnRpY2tWaWV3Qm94IDw9IDApICYmICh0aGlzLmdhbWVTZXJ2ZXIucnVuKSkge1xuICAgICAgdGhpcy52aXNpYmxlTm9kZXMgPSB0aGlzLmNhbGNWaWV3Qm94KCk7XG4gICAgICB0aGlzLnRpY2tWaWV3Qm94ID0gMTA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudGlja1ZpZXdCb3gtLTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBSZXNwYXduIGlmIGJvdCBpcyBkZWFkXG4gICAgaWYgKHRoaXMuY2VsbHMubGVuZ3RoIDw9IDApIHtcbiAgICAgIHRoaXMuZ2FtZVNlcnZlci5nYW1lTW9kZS5vblBsYXllclNwYXduKHRoaXMuZ2FtZVNlcnZlcix0aGlzKTtcbiAgICAgIGlmICh0aGlzLmNlbGxzLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgIC8vIElmIHRoZSBib3QgY2Fubm90IHNwYXduIGFueSBjZWxscywgdGhlbiBkaXNjb25uZWN0IGl0XG4gICAgICAgIHRoaXMuc29ja2V0LmNsb3NlKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDYWxjIHByZWRhdG9ycy9wcmV5XG4gICAgdmFyIGNlbGwgPSB0aGlzLmdldExvd2VzdENlbGwoKTtcbiAgICB2YXIgciA9IGNlbGwuZ2V0U2l6ZSgpO1xuICAgIHRoaXMuY2xlYXJMaXN0cygpO1xuXG4gICAgLy8gSWdub3JlcyB0YXJnZXRpbmcgY2VsbHMgYmVsb3cgdGhpcyBtYXNzXG4gICAgdmFyIGlnbm9yZU1hc3MgPSBNYXRoLm1pbigoY2VsbC5tYXNzIC8gMTApLCAxNTApO1xuXG4gICAgLy8gTG9vcFxuICAgIGZvciAobGV0IGkgaW4gdGhpcy52aXNpYmxlTm9kZXMpIHtcbiAgICAgIHZhciBjaGVjayA9IHRoaXMudmlzaWJsZU5vZGVzW2ldO1xuXG4gICAgICAvLyBDYW5ub3QgdGFyZ2V0IGl0c2VsZlxuICAgICAgaWYgKCghY2hlY2spIHx8IChjZWxsLm93bmVyID09IGNoZWNrLm93bmVyKSl7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICB2YXIgdCA9IGNoZWNrLmdldFR5cGUoKTtcbiAgICAgIHN3aXRjaCAodCkge1xuICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgLy8gQ2Fubm90IHRhcmdldCB0ZWFtbWF0ZXNcbiAgICAgICAgICBpZiAodGhpcy5nYW1lU2VydmVyLmdhbWVNb2RlLmhhdmVUZWFtcykge1xuICAgICAgICAgICAgaWYgKGNoZWNrLm93bmVyLnRlYW0gPT0gdGhpcy50ZWFtKSB7XG4gICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIENoZWNrIGZvciBkYW5nZXJcbiAgICAgICAgICBpZiAoY2VsbC5tYXNzID4gKGNoZWNrLm1hc3MgKiAxLjI1KSkge1xuICAgICAgICAgICAgLy8gQWRkIHRvIHByZXkgbGlzdFxuICAgICAgICAgICAgdGhpcy5wcmV5LnB1c2goY2hlY2spO1xuICAgICAgICAgIH0gZWxzZSBpZiAoY2hlY2subWFzcyA+IChjZWxsLm1hc3MgKiAxLjI1KSkge1xuICAgICAgICAgICAgLy8gUHJlZGF0b3JcbiAgICAgICAgICAgIHZhciBkaXN0ID0gdGhpcy5nZXREaXN0KGNlbGwsIGNoZWNrKSAtIChyICsgY2hlY2suZ2V0U2l6ZSgpKTtcbiAgICAgICAgICAgIGlmIChkaXN0IDwgMzAwKSB7XG4gICAgICAgICAgICAgIHRoaXMucHJlZGF0b3JzLnB1c2goY2hlY2spO1xuICAgICAgICAgICAgICBpZiAoKHRoaXMuY2VsbHMubGVuZ3RoID09IDEpICYmIChkaXN0IDwgMCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmp1a2UgPSB0cnVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnRocmVhdHMucHVzaChjaGVjayk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudGhyZWF0cy5wdXNoKGNoZWNrKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMTpcbiAgICAgICAgICB0aGlzLmZvb2QucHVzaChjaGVjayk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMjogLy8gVmlydXNcbiAgICAgICAgICB0aGlzLnZpcnVzLnB1c2goY2hlY2spO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDM6IC8vIEVqZWN0ZWQgbWFzc1xuICAgICAgICAgIGlmIChjZWxsLm1hc3MgPiAyMCkge1xuICAgICAgICAgICAgdGhpcy5mb29kLnB1c2goY2hlY2spO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBHZXQgZ2FtZXN0YXRlXG4gICAgdmFyIG5ld1N0YXRlID0gdGhpcy5nZXRTdGF0ZShjZWxsKTtcbiAgICBpZiAoKG5ld1N0YXRlICE9IHRoaXMuZ2FtZVN0YXRlKSAmJiAobmV3U3RhdGUgIT0gNCkpIHtcbiAgICAgIC8vIENsZWFyIHRhcmdldFxuICAgICAgdGhpcy50YXJnZXQgPSBudWxsO1xuICAgIH1cbiAgICB0aGlzLmdhbWVTdGF0ZSA9IG5ld1N0YXRlO1xuXG4gICAgLy8gQWN0aW9uXG4gICAgdGhpcy5kZWNpZGUoY2VsbCk7XG5cbiAgICB0aGlzLm5vZGVEZXN0cm95UXVldWUgPSBbXTsgLy8gRW1wdHlcblxuICB9XG5cbiAgLy8gQ3VzdG9tXG5cbiAgY2xlYXJMaXN0cygpIHtcbiAgICB0aGlzLnByZWRhdG9ycyA9IFtdO1xuICAgIHRoaXMudGhyZWF0cyA9IFtdO1xuICAgIHRoaXMucHJleSA9IFtdO1xuICAgIHRoaXMuZm9vZCA9IFtdO1xuICAgIHRoaXMudmlydXMgPSBbXTtcbiAgICB0aGlzLmp1a2UgPSBmYWxzZTtcbiAgfVxuXG4gIGdldFN0YXRlKGNlbGwpIHtcbiAgICAvLyBDb250aW51ZSB0byBzaG9vdCB2aXJ1c2VzXG4gICAgaWYgKHRoaXMuZ2FtZVN0YXRlID09IDQpIHtcbiAgICAgIHJldHVybiA0O1xuICAgIH1cblxuICAgIC8vIENoZWNrIGZvciBwcmVkYXRvcnNcbiAgICBpZiAodGhpcy5wcmVkYXRvcnMubGVuZ3RoIDw9IDApIHtcbiAgICAgIGlmICh0aGlzLnByZXkubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm4gMztcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5mb29kLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0aGlzLnRocmVhdHMubGVuZ3RoID4gMCkge1xuICAgICAgaWYgKCh0aGlzLmNlbGxzLmxlbmd0aCA9PSAxKSAmJiAoY2VsbC5tYXNzID4gMTgwKSkge1xuICAgICAgICB2YXIgdCA9IHRoaXMuZ2V0QmlnZ2VzdCh0aGlzLnRocmVhdHMpO1xuICAgICAgICB2YXIgdGwgPSB0aGlzLmZpbmROZWFyYnlWaXJ1cyh0LDUwMCx0aGlzLnZpcnVzKTtcbiAgICAgICAgaWYgKHRsICE9IGZhbHNlKSB7XG4gICAgICAgICAgdGhpcy50YXJnZXQgPSB0O1xuICAgICAgICAgIHRoaXMudGFyZ2V0VmlydXMgPSB0bDtcbiAgICAgICAgICByZXR1cm4gNDtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUnVuXG4gICAgICAgIHJldHVybiAyO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEJvdCB3YW5kZXJzIGJ5IGRlZmF1bHRcbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIGRlY2lkZShjZWxsKSB7XG4gICAgLy8gVGhlIGJvdCBkZWNpZGVzIHdoYXQgdG8gZG8gYmFzZWQgb24gZ2FtZXN0YXRlXG4gICAgc3dpdGNoICh0aGlzLmdhbWVTdGF0ZSkge1xuICAgICAgY2FzZSAwOiAvLyBXYW5kZXJcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcIltCb3RdIFwiK2NlbGwuZ2V0TmFtZSgpK1wiOiBXYW5kZXJpbmdcIik7XG4gICAgICAgIGlmICgodGhpcy5jZW50ZXJQb3MueCA9PSB0aGlzLm1vdXNlLngpICYmICh0aGlzLmNlbnRlclBvcy55ID09IHRoaXMubW91c2UueSkpIHtcbiAgICAgICAgICAvLyBHZXQgYSBuZXcgcG9zaXRpb25cbiAgICAgICAgICB2YXIgaW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLmdhbWVTZXJ2ZXIubm9kZXMubGVuZ3RoKTtcbiAgICAgICAgICB2YXIgcmFuZG9tTm9kZSA9IHRoaXMuZ2FtZVNlcnZlci5ub2Rlc1tpbmRleF07XG4gICAgICAgICAgdmFyIHBvcyA9IHt4OiAwLCB5OiAwfTtcblxuICAgICAgICAgIGlmICgocmFuZG9tTm9kZS5nZXRUeXBlKCkgPT0gMykgfHwgKHJhbmRvbU5vZGUuZ2V0VHlwZSgpID09IDEpKSB7XG4gICAgICAgICAgICBwb3MueCA9IHJhbmRvbU5vZGUucG9zaXRpb24ueDtcbiAgICAgICAgICAgIHBvcy55ID0gcmFuZG9tTm9kZS5wb3NpdGlvbi55O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBOb3QgYSBmb29kL2VqZWN0ZWQgY2VsbFxuICAgICAgICAgICAgcG9zID0gdGhpcy5nYW1lU2VydmVyLmdldFJhbmRvbVBvc2l0aW9uKCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gU2V0IGJvdCdzIG1vdXNlIGNvb3JkcyB0byB0aGlzIGxvY2F0aW9uXG4gICAgICAgICAgdGhpcy5tb3VzZSA9IHt4OiBwb3MueCwgeTogcG9zLnl9O1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAxOiAvLyBMb29raW5nIGZvciBmb29kXG4gICAgICAgIC8vY29uc29sZS5sb2coXCJbQm90XSBcIitjZWxsLmdldE5hbWUoKStcIjogR2V0dGluZyBGb29kXCIpO1xuICAgICAgICBpZiAoKCF0aGlzLnRhcmdldCkgfHwgKHRoaXMudmlzaWJsZU5vZGVzLmluZGV4T2YodGhpcy50YXJnZXQpID09IC0xKSkge1xuICAgICAgICAgIC8vIEZvb2QgaXMgZWF0ZW4vb3V0IG9mIHNpZ2h0Li4uIHNvIGZpbmQgYSBuZXcgZm9vZCBjZWxsIHRvIHRhcmdldFxuICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGhpcy5maW5kTmVhcmVzdChjZWxsLHRoaXMuZm9vZCk7XG5cbiAgICAgICAgICB0aGlzLm1vdXNlID0ge3g6IHRoaXMudGFyZ2V0LnBvc2l0aW9uLngsIHk6IHRoaXMudGFyZ2V0LnBvc2l0aW9uLnl9O1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOiAvLyBSdW4gZnJvbSAocG90ZW50aWFsKSBwcmVkYXRvcnNcbiAgICAgICAgdmFyIGF2b2lkID0gdGhpcy5jb21iaW5lVmVjdG9ycyh0aGlzLnByZWRhdG9ycyk7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJbQm90XSBcIitjZWxsLmdldE5hbWUoKStcIjogRmxlZWluZyBmcm9tIFwiK2F2b2lkLmdldE5hbWUoKSk7XG5cbiAgICAgICAgLy8gRmluZCBhbmdsZSBvZiB2ZWN0b3IgYmV0d2VlbiBjZWxsIGFuZCBwcmVkYXRvclxuICAgICAgICB2YXIgZGVsdGFZID0gYXZvaWQueSAtIGNlbGwucG9zaXRpb24ueTtcbiAgICAgICAgdmFyIGRlbHRhWCA9IGF2b2lkLnggLSBjZWxsLnBvc2l0aW9uLng7XG4gICAgICAgIHZhciBhbmdsZSA9IE1hdGguYXRhbjIoZGVsdGFYLGRlbHRhWSk7XG5cbiAgICAgICAgLy8gTm93IHJldmVyc2UgdGhlIGFuZ2xlXG4gICAgICAgIGlmIChhbmdsZSA+IE1hdGguUEkpIHtcbiAgICAgICAgICBhbmdsZSAtPSBNYXRoLlBJO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFuZ2xlICs9IE1hdGguUEk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBEaXJlY3Rpb24gdG8gbW92ZVxuICAgICAgICB2YXIgeDEgPSBjZWxsLnBvc2l0aW9uLnggKyAoNTAwICogTWF0aC5zaW4oYW5nbGUpKTtcbiAgICAgICAgdmFyIHkxID0gY2VsbC5wb3NpdGlvbi55ICsgKDUwMCAqIE1hdGguY29zKGFuZ2xlKSk7XG5cbiAgICAgICAgdGhpcy5tb3VzZSA9IHt4OiB4MSwgeTogeTF9O1xuXG4gICAgICAgIC8vIENoZWF0aW5nXG4gICAgICAgIGlmIChjZWxsLm1hc3MgPCAyNTApIHtcbiAgICAgICAgICBjZWxsLm1hc3MgKz0gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmp1a2UpIHtcbiAgICAgICAgICAvLyBKdWtpbmdcbiAgICAgICAgICB0aGlzLmdhbWVTZXJ2ZXIuc3BsaXRDZWxscyh0aGlzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOiAvLyBUYXJnZXQgcHJleVxuICAgICAgICBpZiAoKCF0aGlzLnRhcmdldCkgfHwgKGNlbGwubWFzcyA8ICh0aGlzLnRhcmdldC5tYXNzICogMS4yNSkpIHx8ICh0aGlzLnZpc2libGVOb2Rlcy5pbmRleE9mKHRoaXMudGFyZ2V0KSA9PSAtMSkpIHtcbiAgICAgICAgICB0aGlzLnRhcmdldCA9IHRoaXMuZ2V0UmFuZG9tKHRoaXMucHJleSk7XG4gICAgICAgIH1cbiAgICAgICAgLy9jb25zb2xlLmxvZyhcIltCb3RdIFwiK2NlbGwuZ2V0TmFtZSgpK1wiOiBUYXJnZXRpbmcgXCIrdGhpcy50YXJnZXQuZ2V0TmFtZSgpKTtcblxuXG4gICAgICAgIHRoaXMubW91c2UgPSB7eDogdGhpcy50YXJnZXQucG9zaXRpb24ueCwgeTogdGhpcy50YXJnZXQucG9zaXRpb24ueX07XG5cbiAgICAgICAgdmFyIG1hc3NSZXEgPSAxLjI1ICogKHRoaXMudGFyZ2V0Lm1hc3MgKiAyICk7IC8vIE1hc3MgcmVxdWlyZWQgdG8gc3BsaXRraWxsIHRoZSB0YXJnZXRcblxuICAgICAgICBpZiAoKGNlbGwubWFzcyA+IG1hc3NSZXEpICYmICh0aGlzLmNlbGxzLmxlbmd0aCA9PSAxKSkgeyAvLyBXaWxsIG5vdCBzcGxpdCBpbnRvIG1vcmUgdGhhbiAyIGNlbGxzXG4gICAgICAgICAgdmFyIHNwbGl0RGlzdCA9ICg0ICogKGNlbGwuZ2V0U3BlZWQoKSAqIDUpKSArIChjZWxsLmdldFNpemUoKSAqIDEuNzUpOyAvLyBEaXN0YW5jZSBuZWVkZWQgdG8gc3BsaXRraWxsXG4gICAgICAgICAgdmFyIGRpc3RUb1RhcmdldCA9IHRoaXMuZ2V0QWNjRGlzdChjZWxsLHRoaXMudGFyZ2V0KTsgLy8gRGlzdGFuY2UgYmV0d2VlbiB0aGUgdGFyZ2V0IGFuZCB0aGlzIGNlbGxcblxuICAgICAgICAgIGlmIChzcGxpdERpc3QgPj0gZGlzdFRvVGFyZ2V0KSB7XG4gICAgICAgICAgICBpZiAoKHRoaXMudGhyZWF0cy5sZW5ndGggPiAwKSAmJiAodGhpcy5nZXRCaWdnZXN0KHRoaXMudGhyZWF0cykubWFzcyA+ICgxLjI1ICogKGNlbGwubWFzcy8yKSkpKSB7XG4gICAgICAgICAgICAgIC8vIERvbnQgc3BsaXRraWxsIHdoZW4gdGhleSBhcmUgY2VsbHMgdGhhdCBjYW4gcG9zc2libHkgZWF0IHlvdSBhZnRlciB0aGUgc3BsaXRcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBTcGxpdGtpbGxcbiAgICAgICAgICAgIHRoaXMuZ2FtZVNlcnZlci5zcGxpdENlbGxzKHRoaXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDogLy8gU2hvb3QgdmlydXNcbiAgICAgICAgaWYgKCAgICghdGhpcy50YXJnZXQpXG4gICAgICAgICAgICB8fCAoIXRoaXMudGFyZ2V0VmlydXMpXG4gICAgICAgICAgICB8fCAodGhpcy5jZWxscy5sZW5ndGggIT09IDEpXG4gICAgICAgICAgICB8fCAodGhpcy52aXNpYmxlTm9kZXMuaW5kZXhPZih0aGlzLnRhcmdldCkgPT0gLTEpXG4gICAgICAgICAgICB8fCAodGhpcy52aXNpYmxlTm9kZXMuaW5kZXhPZih0aGlzLnRhcmdldFZpcnVzKSA9PSAtMSkpIHtcbiAgICAgICAgICB0aGlzLmdhbWVTdGF0ZSA9IDA7IC8vIFJlc2V0XG4gICAgICAgICAgdGhpcy50YXJnZXQgPSBudWxsO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTWFrZSBzdXJlIHRhcmdldCBpcyB3aXRoaW4gcmFuZ2VcbiAgICAgICAgdmFyIGRpc3QgPSB0aGlzLmdldERpc3QodGhpcy50YXJnZXRWaXJ1cyx0aGlzLnRhcmdldCkgLSAodGhpcy50YXJnZXQuZ2V0U2l6ZSgpICsgMTAwKTtcbiAgICAgICAgaWYgKGRpc3QgPiA1MDApIHtcbiAgICAgICAgICB0aGlzLmdhbWVTdGF0ZSA9IDA7IC8vIFJlc2V0XG4gICAgICAgICAgdGhpcy50YXJnZXQgPSBudWxsO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmluZCBhbmdsZSBvZiB2ZWN0b3IgYmV0d2VlbiB0YXJnZXQgYW5kIHZpcnVzXG4gICAgICAgIHZhciBhbmdsZSA9IHRoaXMuZ2V0QW5nbGUodGhpcy50YXJnZXQsdGhpcy50YXJnZXRWaXJ1cyk7XG5cbiAgICAgICAgLy8gTm93IHJldmVyc2UgdGhlIGFuZ2xlXG4gICAgICAgIHZhciByZXZlcnNlZCA9IHRoaXMucmV2ZXJzZUFuZ2xlKGFuZ2xlKTtcblxuICAgICAgICAvLyBHZXQgdGhpcyBib3QgY2VsbCdzIGFuZ2xlXG4gICAgICAgIHZhciBvdXJBbmdsZSA9IHRoaXMuZ2V0QW5nbGUoY2VsbCx0aGlzLnRhcmdldFZpcnVzKTtcblxuICAgICAgICAvLyBDaGVjayBpZiBib3QgY2VsbCBpcyBpbiBwb3NpdGlvblxuICAgICAgICBpZiAoKG91ckFuZ2xlIDw9IChyZXZlcnNlZCArIC4yNSkgKSAmJiAob3VyQW5nbGUgPj0gKHJldmVyc2VkIC0gLjI1KSApKSB7XG4gICAgICAgICAgLy8gSW4gcG9zaXRpb24hXG4gICAgICAgICAgdGhpcy5tb3VzZSA9IHt4OiB0aGlzLnRhcmdldFZpcnVzLnBvc2l0aW9uLngsIHk6IHRoaXMudGFyZ2V0VmlydXMucG9zaXRpb24ueX07XG5cbiAgICAgICAgICAvLyBTaG9vdFxuICAgICAgICAgIGZvciAodmFyIHYgPSAwOyB2IDwgNyA7disrKSB7XG4gICAgICAgICAgICB0aGlzLmdhbWVTZXJ2ZXIuZWplY3RNYXNzKHRoaXMpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIEJhY2sgdG8gc3RhcnRpbmcgcG9zXG4gICAgICAgICAgdGhpcy5tb3VzZSA9IHt4OiBjZWxsLnBvc2l0aW9uLngsIHk6IGNlbGwucG9zaXRpb24ueX07XG5cbiAgICAgICAgICAvLyBDbGVhbnVwXG4gICAgICAgICAgdGhpcy5nYW1lU3RhdGUgPSAwOyAvLyBSZXNldFxuICAgICAgICAgIHRoaXMudGFyZ2V0ID0gbnVsbDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBNb3ZlIHRvIHBvc2l0aW9uXG4gICAgICAgICAgbGV0IHIgPSBjZWxsLmdldFNpemUoKTtcbiAgICAgICAgICBsZXQgeDEgPSB0aGlzLnRhcmdldFZpcnVzLnBvc2l0aW9uLnggKyAoKDM1MCArIHIpICogTWF0aC5zaW4ocmV2ZXJzZWQpKTtcbiAgICAgICAgICBsZXQgeTEgPSB0aGlzLnRhcmdldFZpcnVzLnBvc2l0aW9uLnkgKyAoKDM1MCArIHIpICogTWF0aC5jb3MocmV2ZXJzZWQpKTtcbiAgICAgICAgICB0aGlzLm1vdXNlID0ge3g6IHgxLCB5OiB5MX07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIltCb3RdIFwiK2NlbGwuZ2V0TmFtZSgpK1wiOiBUYXJnZXRpbmcgKHZpcnVzKSBcIit0aGlzLnRhcmdldC5nZXROYW1lKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJbQm90XSBcIitjZWxsLmdldE5hbWUoKStcIjogSWRsZSBcIit0aGlzLmdhbWVTdGF0ZSk7XG4gICAgICAgIHRoaXMuZ2FtZVN0YXRlID0gMDtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgLy8gUmVjb21iaW5pbmdcbiAgICBpZiAodGhpcy5jZWxscy5sZW5ndGggPiAxKSB7XG4gICAgICB2YXIgciA9IDA7XG4gICAgICAvLyBHZXQgYW1vdW50IG9mIGNlbGxzIHRoYXQgY2FuIG1lcmdlXG4gICAgICBmb3IgKHZhciBpIGluIHRoaXMuY2VsbHMpIHtcbiAgICAgICAgaWYgKHRoaXMuY2VsbHNbaV0ucmVjb21iaW5lVGlja3MgPT0gMCkge1xuICAgICAgICAgIHIrKztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gTWVyZ2VcbiAgICAgIGlmIChyID49IDIpIHtcbiAgICAgICAgdGhpcy5tb3VzZS54ID0gdGhpcy5jZW50ZXJQb3MueDtcbiAgICAgICAgdGhpcy5tb3VzZS55ID0gdGhpcy5jZW50ZXJQb3MueTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBGaW5kcyB0aGUgbmVhcmVzdCBjZWxsIGluIGxpc3RcbiAgZmluZE5lYXJlc3QoY2VsbCxsaXN0KSB7XG5cbiAgICAvKiBUT0RPIGZpZ3VyZSBvdXQgd2hhdCB0aGlzLmN1cnJlbnRUYXJnZXQgaXMgc3VwcG9zZWQgdG8gYmUgYW5kIHdoZXJlIGl0XG4gICAgICogaXMgc3VwcG9zZWQgdG8gYmUgc2V0XG4gICAgaWYgKHRoaXMuY3VycmVudFRhcmdldCkge1xuICAgICAgLy8gRG8gbm90IGNoZWNrIGZvciBmb29kIGlmIHRhcmdldCBhbHJlYWR5IGV4aXN0c1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgICovXG5cbiAgICAvLyBDaGVjayBmb3IgbmVhcmVzdCBjZWxsIGluIGxpc3RcbiAgICB2YXIgc2hvcnRlc3QgPSBsaXN0WzBdO1xuICAgIHZhciBzaG9ydGVzdERpc3QgPSB0aGlzLmdldERpc3QoY2VsbCxzaG9ydGVzdCk7XG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgY2hlY2sgPSBsaXN0W2ldO1xuICAgICAgdmFyIGRpc3QgPSB0aGlzLmdldERpc3QoY2VsbCxjaGVjayk7XG4gICAgICBpZiAoc2hvcnRlc3REaXN0ID4gZGlzdCkge1xuICAgICAgICBzaG9ydGVzdCA9IGNoZWNrO1xuICAgICAgICBzaG9ydGVzdERpc3QgPSBkaXN0O1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBzaG9ydGVzdDtcbiAgfVxuXG4gIGdldFJhbmRvbShsaXN0KSB7XG4gICAgLy8gR2V0cyBhIHJhbmRvbSBjZWxsIGZyb20gdGhlIGFycmF5XG4gICAgdmFyIG4gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBsaXN0Lmxlbmd0aCk7XG4gICAgcmV0dXJuIGxpc3Rbbl07XG4gIH1cblxuICBjb21iaW5lVmVjdG9ycyhsaXN0KSB7XG4gICAgLy8gR2V0cyB0aGUgYW5nbGVzIG9mIGFsbCBlbmVtaWVzIGFwcHJvYWNoaW5nIHRoZSBjZWxsXG4gICAgdmFyIHBvcyA9IHt4OiAwLCB5OiAwfTtcbiAgICB2YXIgY2hlY2s7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBjaGVjayA9IGxpc3RbaV07XG4gICAgICBwb3MueCArPSBjaGVjay5wb3NpdGlvbi54O1xuICAgICAgcG9zLnkgKz0gY2hlY2sucG9zaXRpb24ueTtcbiAgICB9XG5cbiAgICAvLyBHZXQgYXZnXG4gICAgcG9zLnggPSBwb3MueC9saXN0Lmxlbmd0aDtcbiAgICBwb3MueSA9IHBvcy55L2xpc3QubGVuZ3RoO1xuXG4gICAgcmV0dXJuIHBvcztcbiAgfVxuXG4gIGdldEJpZ2dlc3QobGlzdCkge1xuICAgIC8vIEdldHMgdGhlIGJpZ2dlc3QgY2VsbCBmcm9tIHRoZSBhcnJheVxuICAgIHZhciBiaWdnZXN0ID0gbGlzdFswXTtcbiAgICBmb3IgKHZhciBpID0gMTsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBjaGVjayA9IGxpc3RbaV07XG4gICAgICBpZiAoY2hlY2subWFzcyA+IGJpZ2dlc3QubWFzcykge1xuICAgICAgICBiaWdnZXN0ID0gY2hlY2s7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGJpZ2dlc3Q7XG4gIH1cblxuICBmaW5kTmVhcmJ5VmlydXMoY2VsbCxjaGVja0Rpc3QsbGlzdCkge1xuICAgIHZhciByID0gY2VsbC5nZXRTaXplKCkgKyAxMDA7IC8vIEdldHMgcmFkaXVzICsgdmlydXMgcmFkaXVzXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgY2hlY2sgPSBsaXN0W2ldO1xuICAgICAgdmFyIGRpc3QgPSB0aGlzLmdldERpc3QoY2VsbCxjaGVjaykgLSByO1xuICAgICAgaWYgKGNoZWNrRGlzdCA+IGRpc3QpIHtcbiAgICAgICAgcmV0dXJuIGNoZWNrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7IC8vIFJldHVybnMgYSBib29sIGlmIG5vIG5lYXJieSB2aXJ1c2VzIGFyZSBmb3VuZFxuICB9XG5cbiAgZ2V0RGlzdChjZWxsLGNoZWNrKSB7XG4gICAgLy8gRmFzdGVzdCBkaXN0YW5jZSAtIEkgaGF2ZSBhIGNyYXBweSBjb21wdXRlciB0byB0ZXN0IHdpdGggOihcbiAgICB2YXIgeGQgPSAoY2hlY2sucG9zaXRpb24ueCAtIGNlbGwucG9zaXRpb24ueCk7XG4gICAgeGQgPSB4ZCA8IDAgPyB4ZCAqIC0xIDogeGQ7IC8vIE1hdGguYWJzIGlzIHNsb3dcblxuICAgIHZhciB5ZCA9IChjaGVjay5wb3NpdGlvbi55IC0gY2VsbC5wb3NpdGlvbi55KTtcbiAgICB5ZCA9IHlkIDwgMCA/IHlkICogLTEgOiB5ZDsgLy8gTWF0aC5hYnMgaXMgc2xvd1xuXG4gICAgcmV0dXJuICh4ZCArIHlkKTtcbiAgfVxuXG4gIGdldEFjY0Rpc3QoY2VsbCxjaGVjaykge1xuICAgIC8vIEFjY3VyYXRlIERpc3RhbmNlXG4gICAgdmFyIHhzID0gY2hlY2sucG9zaXRpb24ueCAtIGNlbGwucG9zaXRpb24ueDtcbiAgICB4cyA9IHhzICogeHM7XG5cbiAgICB2YXIgeXMgPSBjaGVjay5wb3NpdGlvbi55IC0gY2VsbC5wb3NpdGlvbi55O1xuICAgIHlzID0geXMgKiB5cztcblxuICAgIHJldHVybiBNYXRoLnNxcnQoIHhzICsgeXMgKTtcbiAgfVxuXG4gIGdldEFuZ2xlKGMxLGMyKSB7XG4gICAgdmFyIGRlbHRhWSA9IGMxLnBvc2l0aW9uLnkgLSBjMi5wb3NpdGlvbi55O1xuICAgIHZhciBkZWx0YVggPSBjMS5wb3NpdGlvbi54IC0gYzIucG9zaXRpb24ueDtcbiAgICByZXR1cm4gTWF0aC5hdGFuMihkZWx0YVgsZGVsdGFZKTtcbiAgfVxuXG4gIHJldmVyc2VBbmdsZShhbmdsZSkge1xuICAgIGlmIChhbmdsZSA+IE1hdGguUEkpIHtcbiAgICAgIGFuZ2xlIC09IE1hdGguUEk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFuZ2xlICs9IE1hdGguUEk7XG4gICAgfVxuICAgIHJldHVybiBhbmdsZTtcbiAgfVxuXG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
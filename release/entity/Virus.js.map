{"version":3,"sources":["entity/Virus.ts"],"names":["Virus","Virus.constructor","Virus.calcMove","Virus.feed","Virus.getEatingRange","Virus.onConsume","Virus.onAdd","Virus.onRemove"],"mappings":"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","file":"entity/Virus.js","sourcesContent":["import Cell from './Cell';\n\nexport default class Virus extends Cell{\n  spiked: number;\n  fed: number;\n\n  constructor(nodeId, owner, position, mass, gameServer){\n    super(nodeId, owner, position, mass, gameServer);\n    this.cellType = 2;\n    this.spiked = 1;\n    this.fed = 0;\n  }\n\n  calcMove(){\n    // no-op Only for player controlled movement\n  }\n\n  feed(feeder,gameServer) {\n    // Set direction if the virus explodes\n    this.setAngle(feeder.getAngle());\n    this.mass += feeder.mass;\n    this.fed++; // Increase feed count\n    gameServer.removeNode(feeder);\n\n    // Check if the virus is going to explode\n    if (this.fed >= gameServer.config.virusFeedAmount) {\n      this.mass = gameServer.config.virusStartMass; // Reset mass\n      this.fed = 0;\n      gameServer.shootVirus(this);\n    }\n\n  }\n\n  // Main Functions\n\n  getEatingRange() {\n    return this.getSize() * .4; // 0 for ejected cells\n  }\n\n  onConsume(consumer,gameServer) {\n    var client = consumer.owner;\n\n    // Maximum amount of splits\n    var maxSplits = Math.floor(consumer.mass/16) - 1;\n    // Get number of splits\n    var numSplits = gameServer.config.playerMaxCells - client.cells.length;\n    numSplits = Math.min(numSplits, maxSplits);\n    // Maximum size of new splits\n    var splitMass = Math.min(consumer.mass/(numSplits + 1), 36);\n\n    // Cell consumes mass before splitting\n    consumer.addMass(this.mass);\n\n    // Cell cannot split any further\n    if (numSplits <= 0) {\n      return;\n    }\n\n    // Big cells will split into cells larger than 36 mass (1/4 of their mass)\n    var bigSplits = 0;\n    var endMass = consumer.mass - (numSplits * splitMass);\n    if ((endMass > 300) && (numSplits > 0)) {\n      bigSplits++;\n      numSplits--;\n    }\n    if ((endMass > 1200) && (numSplits > 0)) {\n      bigSplits++;\n      numSplits--;\n    }\n    if ((endMass > 3000) && (numSplits > 0)) {\n      bigSplits++;\n      numSplits--;\n    }\n\n    // Splitting\n    var angle = 0; // Starting angle\n    for (var k = 0; k < numSplits; k++) {\n      angle += 6/numSplits; // Get directions of splitting cells\n      gameServer.newCellVirused(client, consumer, angle, splitMass,150);\n      consumer.mass -= splitMass;\n    }\n\n    for (var k = 0; k < bigSplits; k++) {\n      angle = Math.random() * 6.28; // Random directions\n      splitMass = consumer.mass / 4;\n      gameServer.newCellVirused(client, consumer, angle, splitMass,20);\n      consumer.mass -= splitMass;\n    }\n\n    // Prevent consumer cell from merging with other cells\n    consumer.calcMergeTime(gameServer.config.playerRecombineTime);\n  }\n\n  onAdd(gameServer) {\n    gameServer.nodesVirus.push(this);\n  }\n\n  onRemove(gameServer) {\n    var index = gameServer.nodesVirus.indexOf(this);\n    if (index != -1) {\n      gameServer.nodesVirus.splice(index, 1);\n    } else {\n      console.log(\"[Warning] Tried to remove a non existing virus!\");\n    }\n  }\n\n}\n"],"sourceRoot":"/source/"}
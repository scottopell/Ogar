"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Cell = (function () {
    function Cell(nodeId, owner, position, mass, gameServer) {
        _classCallCheck(this, Cell);

        this.nodeId = nodeId;
        this.owner = owner;
        this.color = { r: 0, g: 255, b: 0 };
        this.position = position;
        this.mass = mass;
        this.cellType = -1;
        this.spiked = 0;
        this.killedBy;
        this.gameServer = gameServer;
        this.moveEngineTicks = 0;
        this.moveEngineSpeed = 0;
        this.moveDecay = .75;
        this.angle = 0;
    }

    _createClass(Cell, [{
        key: "getName",
        value: function getName() {
            if (this.owner) {
                return this.owner.name;
            } else {
                return "";
            }
        }
    }, {
        key: "setColor",
        value: function setColor(color) {
            this.color.r = color.r;
            this.color.b = color.b;
            this.color.g = color.g;
        }
    }, {
        key: "getColor",
        value: function getColor() {
            return this.color;
        }
    }, {
        key: "getType",
        value: function getType() {
            return this.cellType;
        }
    }, {
        key: "getSize",
        value: function getSize() {
            return Math.ceil(Math.sqrt(100 * this.mass));
        }
    }, {
        key: "getSquareSize",
        value: function getSquareSize() {
            return 100 * this.mass >> 0;
        }
    }, {
        key: "addMass",
        value: function addMass(n) {
            if (this.mass + n > this.owner.gameServer.config.playerMaxMass && this.owner.cells.length < this.owner.gameServer.config.playerMaxCells) {
                this.mass = (this.mass + n) / 2;
                this.owner.gameServer.newCellVirused(this.owner, this, 0, this.mass, 150);
            } else {
                this.mass = Math.min(this.mass + n, this.owner.gameServer.config.playerMaxMass);
            }
        }
    }, {
        key: "getSpeed",
        value: function getSpeed() {
            return 30 * Math.pow(this.mass, -1.0 / 4.5) * 50 / 40;
        }
    }, {
        key: "setAngle",
        value: function setAngle(radians) {
            this.angle = radians;
        }
    }, {
        key: "getAngle",
        value: function getAngle() {
            return this.angle;
        }
    }, {
        key: "setMoveEngineData",
        value: function setMoveEngineData(speed, ticks, decay) {
            this.moveEngineSpeed = speed;
            this.moveEngineTicks = ticks;
            this.moveDecay = isNaN(decay) ? 0.75 : decay;
        }
    }, {
        key: "getEatingRange",
        value: function getEatingRange() {
            return 0;
        }
    }, {
        key: "getKiller",
        value: function getKiller() {
            return this.killedBy;
        }
    }, {
        key: "setKiller",
        value: function setKiller(cell) {
            this.killedBy = cell;
        }
    }, {
        key: "collisionCheck",
        value: function collisionCheck(bottomY, topY, rightX, leftX) {
            if (this.position.y > bottomY) {
                return false;
            }
            if (this.position.y < topY) {
                return false;
            }
            if (this.position.x > rightX) {
                return false;
            }
            if (this.position.x < leftX) {
                return false;
            }
            return true;
        }
    }, {
        key: "collisionCheck2",
        value: function collisionCheck2(objectSquareSize, objectPosition) {
            // IF (O1O2 + r <= R) THEN collided. (O1O2: distance b/w 2 centers of cells)
            // (O1O2 + r)^2 <= R^2
            // approximately, remove 2*O1O2*r because it requires sqrt(): O1O2^2 + r^2 <= R^2
            var dx = this.position.x - objectPosition.x;
            var dy = this.position.y - objectPosition.y;
            return dx * dx + dy * dy + this.getSquareSize() <= objectSquareSize;
        }
    }, {
        key: "visibleCheck",
        value: function visibleCheck(box, centerPos) {
            return this.collisionCheck(box.bottomY, box.topY, box.rightX, box.leftX);
        }
    }, {
        key: "calcMovePhys",
        value: function calcMovePhys(config) {
            var X = this.position.x + this.moveEngineSpeed * Math.sin(this.angle);
            var Y = this.position.y + this.moveEngineSpeed * Math.cos(this.angle);
            this.moveEngineSpeed *= this.moveDecay;
            this.moveEngineTicks--;
            var radius = 40;
            if (this.position.x - radius < config.borderLeft) {
                this.angle = 6.28 - this.angle;
                X = config.borderLeft + radius;
            }
            if (this.position.x + radius > config.borderRight) {
                this.angle = 6.28 - this.angle;
                X = config.borderRight - radius;
            }
            if (this.position.y - radius < config.borderTop) {
                this.angle = this.angle <= 3.14 ? 3.14 - this.angle : 9.42 - this.angle;
                Y = config.borderTop + radius;
            }
            if (this.position.y + radius > config.borderBottom) {
                this.angle = this.angle <= 3.14 ? 3.14 - this.angle : 9.42 - this.angle;
                Y = config.borderBottom - radius;
            }
            this.position.x = X >> 0;
            this.position.y = Y >> 0;
        }
    }, {
        key: "sendUpdate",
        value: function sendUpdate() {
            return true;
        }
    }, {
        key: "onConsume",
        value: function onConsume(consumer, gameServer) {}
    }, {
        key: "onAdd",
        value: function onAdd(gameServer) {}
    }, {
        key: "onRemove",
        value: function onRemove(gameServer) {}
    }, {
        key: "onAutoMove",
        value: function onAutoMove(gameServer) {}
    }, {
        key: "moveDone",
        value: function moveDone(gameServer) {}
    }]);

    return Cell;
})();

exports["default"] = Cell;
module.exports = exports["default"];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVudGl0eS9DZWxsLnRzIl0sIm5hbWVzIjpbIkNlbGwiLCJDZWxsLmNvbnN0cnVjdG9yIiwiQ2VsbC5nZXROYW1lIiwiQ2VsbC5zZXRDb2xvciIsIkNlbGwuZ2V0Q29sb3IiLCJDZWxsLmdldFR5cGUiLCJDZWxsLmdldFNpemUiLCJDZWxsLmdldFNxdWFyZVNpemUiLCJDZWxsLmFkZE1hc3MiLCJDZWxsLmdldFNwZWVkIiwiQ2VsbC5zZXRBbmdsZSIsIkNlbGwuZ2V0QW5nbGUiLCJDZWxsLnNldE1vdmVFbmdpbmVEYXRhIiwiQ2VsbC5nZXRFYXRpbmdSYW5nZSIsIkNlbGwuZ2V0S2lsbGVyIiwiQ2VsbC5zZXRLaWxsZXIiLCJDZWxsLmNvbGxpc2lvbkNoZWNrIiwiQ2VsbC5jb2xsaXNpb25DaGVjazIiLCJDZWxsLnZpc2libGVDaGVjayIsIkNlbGwuY2FsY01vdmVQaHlzIiwiQ2VsbC5zZW5kVXBkYXRlIiwiQ2VsbC5vbkNvbnN1bWUiLCJDZWxsLm9uQWRkIiwiQ2VsbC5vblJlbW92ZSIsIkNlbGwub25BdXRvTW92ZSIsIkNlbGwubW92ZURvbmUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7SUFJQSxJQUFBO0FBc0JFQSxhQXRCRixJQUFBLENBdUJNQSxNQUFjQSxFQUNkQSxLQUFvQkEsRUFDcEJBLFFBQWtCQSxFQUNsQkEsSUFBWUEsRUFDWkEsVUFBc0JBLEVBQUFBOzhCQTNCNUIsSUFBQTs7QUE0QklDLFlBQUlBLENBQUNBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBO0FBRXJCQSxZQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQTtBQUNuQkEsWUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsRUFBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBQ0EsQ0FBQ0E7QUFDbENBLFlBQUlBLENBQUNBLFFBQVFBLEdBQUdBLFFBQVFBLENBQUNBO0FBRXpCQSxZQUFJQSxDQUFD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Q0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQUFBRUEsQ0FBQ0E7QUFDMUVBLGdCQUFJQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxHQUFLQSxJQUFJQSxDQUFDQSxlQUFlQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxBQUFFQSxDQUFDQTtBQUcxRUEsZ0JBQUlBLENBQUNBLGVBQWVBLElBQUlBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBO0FBQ3ZDQSxnQkFBSUEsQ0FBQ0EsZUFBZUEsRUFBRUEsQ0FBQ0E7QUFHdkJBLGdCQUFJQSxNQUFNQSxHQUFHQSxFQUFFQSxDQUFDQTtBQUNoQkEsZ0JBQUlBLEFBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEdBQUdBLE1BQU1BLEdBQUlBLE1BQU1BLENBQUNBLFVBQVVBLEVBQUVBO0FBRWxEQSxvQkFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7QUFDL0JBLGlCQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxVQUFVQSxHQUFHQSxNQUFNQSxDQUFDQTthQUNoQ0E7QUFDREEsZ0JBQUlBLEFBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEdBQUdBLE1BQU1BLEdBQUlBLE1BQU1BLENBQUNBLFdBQVdBLEVBQUVBO0FBRW5EQSxvQkFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7QUFDL0JBLGlCQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxXQUFXQSxHQUFHQSxNQUFNQSxDQUFDQTthQUNqQ0E7QUFDREEsZ0JBQUlBLEFBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEdBQUdBLE1BQU1BLEdBQUlBLE1BQU1BLENBQUNBLFNBQVNBLEVBQUVBO0FBRWpEQSxvQkFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsQUFBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsSUFBSUEsSUFBSUEsR0FBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7QUFDMUVBLGlCQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxTQUFTQSxHQUFHQSxNQUFNQSxDQUFDQTthQUMvQkE7QUFDREEsZ0JBQUlBLEFBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEdBQUdBLE1BQU1BLEdBQUlBLE1BQU1BLENBQUNBLFlBQVlBLEVBQUVBO0FBRXBEQSxvQkFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsQUFBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsSUFBSUEsSUFBSUEsR0FBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7QUFDMUVBLGlCQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxZQUFZQSxHQUFHQSxNQUFNQSxDQUFDQTthQUNsQ0E7QUFHREEsZ0JBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO0FBQ3pCQSxnQkFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7U0FDMUJBOzs7ZUFJU25CLHNCQUFBQTtBQUVSb0IsbUJBQU9BLElBQUlBLENBQUNBO1NBQ2JBOzs7ZUFFUXBCLG1CQUFDQSxRQUFRQSxFQUFDQSxVQUFVQSxFQUFBQSxFQUU1QnFCOzs7ZUFFSXJCLGVBQUNBLFVBQVVBLEVBQUFBLEVBRWZzQjs7O2VBRU90QixrQkFBQ0EsVUFBVUEsRUFBQUEsRUFFbEJ1Qjs7O2VBRVN2QixvQkFBQ0EsVUFBVUEsRUFBQUEsRUFFcEJ3Qjs7O2VBRU94QixrQkFBQ0EsVUFBVUEsRUFBQUEsRUFFbEJ5Qjs7O1dBbk9ILElBQUE7OztxQkFBQSxJQUFBIiwiZmlsZSI6ImVudGl0eS9DZWxsLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29sb3IsIFBvc2l0aW9uIH0gZnJvbSAnLi4vSGVscGVyRGVmcy9pbmRleCdcbmltcG9ydCBHYW1lU2VydmVyIGZyb20gJy4uL0dhbWVTZXJ2ZXInO1xuaW1wb3J0IFBsYXllclRyYWNrZXIgZnJvbSAnLi4vUGxheWVyVHJhY2tlcic7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENlbGx7XG4gIG5vZGVJZDogbnVtYmVyO1xuICBvd25lcjogUGxheWVyVHJhY2tlcjtcbiAgY29sb3I6IENvbG9yO1xuICBwb3NpdGlvbjogUG9zaXRpb247XG4gIG1hc3M6IG51bWJlcjtcblxuICAvLyAwID0gUGxheWVyIENlbGwsIDEgPSBGb29kLCAyID0gVmlydXMsIDMgPSBFamVjdGVkIE1hc3NcbiAgLy8gVE9ETyBlbnVtLCBvciB1dGlsaXplIHN0YXRpYyB0eXBpbmdcbiAgY2VsbFR5cGU6IG51bWJlcjtcbiAgc3Bpa2VkOiBudW1iZXI7XG5cbiAga2lsbGVkQnk6IGFueTtcbiAgZ2FtZVNlcnZlcjogR2FtZVNlcnZlcjtcblxuICBtb3ZlRW5naW5lVGlja3M6IG51bWJlcjtcbiAgbW92ZUVuZ2luZVNwZWVkOiBudW1iZXI7XG4gIG1vdmVEZWNheTogbnVtYmVyO1xuICBhbmdsZTogbnVtYmVyO1xuXG5cblxuICBjb25zdHJ1Y3RvcihcbiAgICAgIG5vZGVJZDogbnVtYmVyLFxuICAgICAgb3duZXI6IFBsYXllclRyYWNrZXIsXG4gICAgICBwb3NpdGlvbjogUG9zaXRpb24sXG4gICAgICBtYXNzOiBudW1iZXIsXG4gICAgICBnYW1lU2VydmVyOiBHYW1lU2VydmVyKSB7XG4gICAgdGhpcy5ub2RlSWQgPSBub2RlSWQ7XG4gICAgLy8gcGxheWVyVHJhY2tlciB0aGF0IG93bnMgdGhpcyBjZWxsXG4gICAgdGhpcy5vd25lciA9IG93bmVyO1xuICAgIHRoaXMuY29sb3IgPSB7cjogMCwgZzogMjU1LCBiOiAwfTtcbiAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247XG4gICAgLy8gU3RhcnRpbmcgbWFzcyBvZiB0aGUgY2VsbFxuICAgIHRoaXMubWFzcyA9IG1hc3M7XG4gICAgdGhpcy5jZWxsVHlwZSA9IC0xO1xuICAgIC8vIElmIDEsIHRoZW4gdGhpcyBjZWxsIGhhcyBzcGlrZXMgYXJvdW5kIGl0XG4gICAgdGhpcy5zcGlrZWQgPSAwO1xuXG4gICAgLy8gQ2VsbCB0aGF0IGF0ZSB0aGlzIGNlbGxcbiAgICB0aGlzLmtpbGxlZEJ5O1xuICAgIHRoaXMuZ2FtZVNlcnZlciA9IGdhbWVTZXJ2ZXI7XG5cbiAgICAvLyBBbW91bnQgb2YgdGltZXMgdG8gbG9vcCB0aGUgbW92ZW1lbnQgZnVuY3Rpb25cbiAgICB0aGlzLm1vdmVFbmdpbmVUaWNrcyA9IDA7XG4gICAgdGhpcy5tb3ZlRW5naW5lU3BlZWQgPSAwO1xuICAgIHRoaXMubW92ZURlY2F5ID0gLjc1O1xuICAgIC8vIEFuZ2xlIG9mIG1vdmVtZW50XG4gICAgdGhpcy5hbmdsZSA9IDA7XG4gIH1cblxuICBnZXROYW1lKCkge1xuICAgIGlmICh0aGlzLm93bmVyKSB7XG4gICAgICByZXR1cm4gdGhpcy5vd25lci5uYW1lO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG4gIH1cblxuICBzZXRDb2xvcihjb2xvcikge1xuICAgIHRoaXMuY29sb3IuciA9IGNvbG9yLnI7XG4gICAgdGhpcy5jb2xvci5iID0gY29sb3IuYjtcbiAgICB0aGlzLmNvbG9yLmcgPSBjb2xvci5nO1xuICB9XG5cbiAgZ2V0Q29sb3IoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29sb3I7XG4gIH1cblxuICBnZXRUeXBlKCkge1xuICAgIHJldHVybiB0aGlzLmNlbGxUeXBlO1xuICB9XG5cbiAgZ2V0U2l6ZSgpIHtcbiAgICAvLyBDYWxjdWxhdGVzIHJhZGl1cyBiYXNlZCBvbiBjZWxsIG1hc3NcbiAgICByZXR1cm4gTWF0aC5jZWlsKE1hdGguc3FydCgxMDAgKiB0aGlzLm1hc3MpKTtcbiAgfVxuXG4gIGdldFNxdWFyZVNpemUgKCkge1xuICAgIC8vIFIgKiBSXG4gICAgcmV0dXJuICgxMDAgKiB0aGlzLm1hc3MpID4+IDA7XG4gIH1cblxuICBhZGRNYXNzKG4pIHtcbiAgICBpZih0aGlzLm1hc3MgKyBuID4gdGhpcy5vd25lci5nYW1lU2VydmVyLmNvbmZpZy5wbGF5ZXJNYXhNYXNzICYmIHRoaXMub3duZXIuY2VsbHMubGVuZ3RoIDwgdGhpcy5vd25lci5nYW1lU2VydmVyLmNvbmZpZy5wbGF5ZXJNYXhDZWxscykge1xuICAgICAgdGhpcy5tYXNzID0gKHRoaXMubWFzcyArIG4pIC8gMjtcbiAgICAgIHRoaXMub3duZXIuZ2FtZVNlcnZlci5uZXdDZWxsVmlydXNlZCh0aGlzLm93bmVyLCB0aGlzLCAwLCB0aGlzLm1hc3MsIDE1MCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubWFzcyA9IE1hdGgubWluKHRoaXMubWFzcyArIG4sdGhpcy5vd25lci5nYW1lU2VydmVyLmNvbmZpZy5wbGF5ZXJNYXhNYXNzKTtcbiAgICB9XG4gIH1cblxuICBnZXRTcGVlZCgpIHtcbiAgICAvLyBPbGQgZm9ybXVsYTogNSArICgyMCAqICgxIC0gKHRoaXMubWFzcy8oNzArdGhpcy5tYXNzKSkpKTtcbiAgICAvLyBCYXNlZCBvbiA1MG1zIHRpY2tzLiBJZiB1cGRhdGVNb3ZlRW5naW5lIGludGVydmFsIGNoYW5nZXMsIGNoYW5nZSA1MCB0byBuZXcgdmFsdWVcbiAgICAvLyAoc2hvdWxkIHBvc3NpYmx5IGhhdmUgYSBjb25maWcgdmFsdWUgZm9yIHRoaXM/KVxuICAgIHJldHVybiAzMCAqIE1hdGgucG93KHRoaXMubWFzcywgLTEuMCAvIDQuNSkgKiA1MCAvIDQwO1xuICB9XG5cbiAgc2V0QW5nbGUocmFkaWFucykge1xuICAgIHRoaXMuYW5nbGUgPSByYWRpYW5zO1xuICB9XG5cbiAgZ2V0QW5nbGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuYW5nbGU7XG4gIH1cblxuICBzZXRNb3ZlRW5naW5lRGF0YShzcGVlZCwgdGlja3MsIGRlY2F5KSB7XG4gICAgdGhpcy5tb3ZlRW5naW5lU3BlZWQgPSBzcGVlZDtcbiAgICB0aGlzLm1vdmVFbmdpbmVUaWNrcyA9IHRpY2tzO1xuICAgIHRoaXMubW92ZURlY2F5ID0gaXNOYU4oZGVjYXkpID8gMC43NSA6IGRlY2F5O1xuICB9XG5cbiAgZ2V0RWF0aW5nUmFuZ2UoKSB7XG4gICAgcmV0dXJuIDA7IC8vIDAgZm9yIGVqZWN0ZWQgY2VsbHNcbiAgfVxuXG4gIGdldEtpbGxlcigpIHtcbiAgICByZXR1cm4gdGhpcy5raWxsZWRCeTtcbiAgfVxuXG4gIHNldEtpbGxlcihjZWxsKSB7XG4gICAgdGhpcy5raWxsZWRCeSA9IGNlbGw7XG4gIH1cblxuICAvLyBGdW5jdGlvbnNcblxuICBjb2xsaXNpb25DaGVjayhib3R0b21ZLHRvcFkscmlnaHRYLGxlZnRYKSB7XG4gICAgLy8gQ29sbGlzaW9uIGNoZWNraW5nXG4gICAgaWYgKHRoaXMucG9zaXRpb24ueSA+IGJvdHRvbVkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5wb3NpdGlvbi55IDwgdG9wWSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnBvc2l0aW9uLnggPiByaWdodFgpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5wb3NpdGlvbi54IDwgbGVmdFgpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8vIFRoaXMgY29sbGlzaW9uIGNoZWNraW5nIGZ1bmN0aW9uIGlzIGJhc2VkIG9uIENJUkNMRSBzaGFwZVxuICBjb2xsaXNpb25DaGVjazIgKG9iamVjdFNxdWFyZVNpemUsIG9iamVjdFBvc2l0aW9uKSB7XG4gICAgLy8gSUYgKE8xTzIgKyByIDw9IFIpIFRIRU4gY29sbGlkZWQuIChPMU8yOiBkaXN0YW5jZSBiL3cgMiBjZW50ZXJzIG9mIGNlbGxzKVxuICAgIC8vIChPMU8yICsgcileMiA8PSBSXjJcbiAgICAvLyBhcHByb3hpbWF0ZWx5LCByZW1vdmUgMipPMU8yKnIgYmVjYXVzZSBpdCByZXF1aXJlcyBzcXJ0KCk6IE8xTzJeMiArIHJeMiA8PSBSXjJcblxuICAgIHZhciBkeCA9IHRoaXMucG9zaXRpb24ueCAtIG9iamVjdFBvc2l0aW9uLng7XG4gICAgdmFyIGR5ID0gdGhpcy5wb3NpdGlvbi55IC0gb2JqZWN0UG9zaXRpb24ueTtcblxuICAgIHJldHVybiAoZHggKiBkeCArIGR5ICogZHkgKyB0aGlzLmdldFNxdWFyZVNpemUoKSA8PSBvYmplY3RTcXVhcmVTaXplKTtcbiAgfVxuXG4gIHZpc2libGVDaGVjayhib3gsY2VudGVyUG9zKSB7XG4gICAgLy8gQ2hlY2tzIGlmIHRoaXMgY2VsbCBpcyB2aXNpYmxlIHRvIHRoZSBwbGF5ZXJcbiAgICByZXR1cm4gdGhpcy5jb2xsaXNpb25DaGVjayhib3guYm90dG9tWSxib3gudG9wWSxib3gucmlnaHRYLGJveC5sZWZ0WCk7XG4gIH1cblxuICBjYWxjTW92ZVBoeXMoY29uZmlnKSB7XG4gICAgLy8gTW92ZW1lbnQgZm9yIGVqZWN0ZWQgY2VsbHNcbiAgICB2YXIgWCA9IHRoaXMucG9zaXRpb24ueCArICggdGhpcy5tb3ZlRW5naW5lU3BlZWQgKiBNYXRoLnNpbih0aGlzLmFuZ2xlKSApO1xuICAgIHZhciBZID0gdGhpcy5wb3NpdGlvbi55ICsgKCB0aGlzLm1vdmVFbmdpbmVTcGVlZCAqIE1hdGguY29zKHRoaXMuYW5nbGUpICk7XG5cbiAgICAvLyBNb3ZlbWVudCBlbmdpbmVcbiAgICB0aGlzLm1vdmVFbmdpbmVTcGVlZCAqPSB0aGlzLm1vdmVEZWNheTsgLy8gRGVjYXlpbmcgc3BlZWRcbiAgICB0aGlzLm1vdmVFbmdpbmVUaWNrcy0tO1xuXG4gICAgLy8gQm9yZGVyIGNoZWNrIC0gQm91bmN5IHBoeXNpY3NcbiAgICB2YXIgcmFkaXVzID0gNDA7XG4gICAgaWYgKCh0aGlzLnBvc2l0aW9uLnggLSByYWRpdXMpIDwgY29uZmlnLmJvcmRlckxlZnQpIHtcbiAgICAgIC8vIEZsaXAgYW5nbGUgaG9yaXpvbnRhbGx5IC0gTGVmdCBzaWRlXG4gICAgICB0aGlzLmFuZ2xlID0gNi4yOCAtIHRoaXMuYW5nbGU7XG4gICAgICBYID0gY29uZmlnLmJvcmRlckxlZnQgKyByYWRpdXM7XG4gICAgfVxuICAgIGlmICgodGhpcy5wb3NpdGlvbi54ICsgcmFkaXVzKSA+IGNvbmZpZy5ib3JkZXJSaWdodCkge1xuICAgICAgLy8gRmxpcCBhbmdsZSBob3Jpem9udGFsbHkgLSBSaWdodCBzaWRlXG4gICAgICB0aGlzLmFuZ2xlID0gNi4yOCAtIHRoaXMuYW5nbGU7XG4gICAgICBYID0gY29uZmlnLmJvcmRlclJpZ2h0IC0gcmFkaXVzO1xuICAgIH1cbiAgICBpZiAoKHRoaXMucG9zaXRpb24ueSAtIHJhZGl1cykgPCBjb25maWcuYm9yZGVyVG9wKSB7XG4gICAgICAvLyBGbGlwIGFuZ2xlIHZlcnRpY2FsbHkgLSBUb3Agc2lkZVxuICAgICAgdGhpcy5hbmdsZSA9ICh0aGlzLmFuZ2xlIDw9IDMuMTQpID8gMy4xNCAtIHRoaXMuYW5nbGUgOiA5LjQyIC0gdGhpcy5hbmdsZTtcbiAgICAgIFkgPSBjb25maWcuYm9yZGVyVG9wICsgcmFkaXVzO1xuICAgIH1cbiAgICBpZiAoKHRoaXMucG9zaXRpb24ueSArIHJhZGl1cykgPiBjb25maWcuYm9yZGVyQm90dG9tKSB7XG4gICAgICAvLyBGbGlwIGFuZ2xlIHZlcnRpY2FsbHkgLSBCb3R0b20gc2lkZVxuICAgICAgdGhpcy5hbmdsZSA9ICh0aGlzLmFuZ2xlIDw9IDMuMTQpID8gMy4xNCAtIHRoaXMuYW5nbGUgOiA5LjQyIC0gdGhpcy5hbmdsZTtcbiAgICAgIFkgPSBjb25maWcuYm9yZGVyQm90dG9tIC0gcmFkaXVzO1xuICAgIH1cblxuICAgIC8vIFNldCBwb3NpdGlvblxuICAgIHRoaXMucG9zaXRpb24ueCA9IFggPj4gMDtcbiAgICB0aGlzLnBvc2l0aW9uLnkgPSBZID4+IDA7XG4gIH1cblxuICAvLyBPdmVycmlkZSB0aGVzZVxuXG4gIHNlbmRVcGRhdGUoKSB7XG4gICAgLy8gV2hldGhlciBvciBub3QgdG8gaW5jbHVkZSB0aGlzIGNlbGwgaW4gdGhlIHVwZGF0ZSBwYWNrZXRcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIG9uQ29uc3VtZShjb25zdW1lcixnYW1lU2VydmVyKSB7XG4gICAgLy8gQ2FsbGVkIHdoZW4gdGhlIGNlbGwgaXMgY29uc3VtZWRcbiAgfVxuXG4gIG9uQWRkKGdhbWVTZXJ2ZXIpIHtcbiAgICAvLyBDYWxsZWQgd2hlbiB0aGlzIGNlbGwgaXMgYWRkZWQgdG8gdGhlIHdvcmxkXG4gIH1cblxuICBvblJlbW92ZShnYW1lU2VydmVyKSB7XG4gICAgLy8gQ2FsbGVkIHdoZW4gdGhpcyBjZWxsIGlzIHJlbW92ZWRcbiAgfVxuXG4gIG9uQXV0b01vdmUoZ2FtZVNlcnZlcikge1xuICAgIC8vIENhbGxlZCBvbiBlYWNoIGF1dG8gbW92ZSBlbmdpbmUgdGlja1xuICB9XG5cbiAgbW92ZURvbmUoZ2FtZVNlcnZlcikge1xuICAgIC8vIENhbGxlZCB3aGVuIHRoaXMgY2VsbCBmaW5pc2hlZCBtb3Zpbmcgd2l0aCB0aGUgYXV0byBtb3ZlIGVuZ2luZVxuICB9XG5cbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var UpdateLeaderboard = (function () {
    function UpdateLeaderboard(leaderboard, packetLB) {
        _classCallCheck(this, UpdateLeaderboard);

        this.leaderboard = leaderboard;
        this.packetLB = packetLB;
    }

    _createClass(UpdateLeaderboard, [{
        key: "build",
        value: function build() {
            var lb = this.leaderboard;
            var bufferSize = 5;
            var validElements = 0;
            switch (this.packetLB) {
                case 48:
                    for (var i = 0; i < lb.length; i++) {
                        if (typeof lb[i] == "undefined") {
                            continue;
                        }
                        var item = lb[i];
                        bufferSize += 4;
                        bufferSize += item.length * 2;
                        bufferSize += 2;
                        validElements++;
                    }
                    var buf = new ArrayBuffer(bufferSize);
                    var view = new DataView(buf);
                    view.setUint8(0, 49);
                    view.setUint32(1, validElements, true);
                    var offset = 5;
                    for (var i = 0; i < lb.length; i++) {
                        if (typeof lb[i] == "undefined") {
                            continue;
                        }
                        var item = lb[i];
                        view.setUint32(offset, 1, true);
                        offset += 4;
                        for (var j = 0; j < item.length; j++) {
                            view.setUint16(offset, item.charCodeAt(j), true);
                            offset += 2;
                        }
                        view.setUint16(offset, 0, true);
                        offset += 2;
                    }
                    return buf;
                    break;
                case 49:
                    for (var i = 0; i < lb.length; i++) {
                        if (typeof lb[i] == "undefined") {
                            continue;
                        }
                        var item = lb[i];
                        bufferSize += 4;
                        bufferSize += item.getName() ? item.getName().length * 2 : 0;
                        bufferSize += 2;
                        validElements++;
                    }
                    var buf = new ArrayBuffer(bufferSize);
                    var view = new DataView(buf);
                    view.setUint8(0, this.packetLB);
                    view.setUint32(1, validElements, true);
                    var offset = 5;
                    for (var i = 0; i < lb.length; i++) {
                        if (typeof lb[i] == "undefined") {
                            continue;
                        }
                        var item = lb[i];
                        var nodeID = 0;
                        if (item.cells[0]) {
                            nodeID = item.cells[0].nodeId;
                        }
                        view.setUint32(offset, nodeID, true);
                        offset += 4;
                        var name = item.getName();
                        if (name) {
                            for (var j = 0; j < name.length; j++) {
                                view.setUint16(offset, name.charCodeAt(j), true);
                                offset += 2;
                            }
                        }
                        view.setUint16(offset, 0, true);
                        offset += 2;
                    }
                    return buf;
                case 50:
                    validElements = lb.length;
                    bufferSize += validElements * 4;
                    var buf = new ArrayBuffer(bufferSize);
                    var view = new DataView(buf);
                    view.setUint8(0, this.packetLB);
                    view.setUint32(1, validElements, true);
                    var offset = 5;
                    for (var i = 0; i < validElements; i++) {
                        view.setFloat32(offset, lb[i], true);
                        offset += 4;
                    }
                    return buf;
                default:
                    break;
            }
        }
    }]);

    return UpdateLeaderboard;
})();

exports["default"] = UpdateLeaderboard;
module.exports = exports["default"];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhY2tldC9VcGRhdGVMZWFkZXJib2FyZC50cyJdLCJuYW1lcyI6WyJVcGRhdGVMZWFkZXJib2FyZCIsIlVwZGF0ZUxlYWRlcmJvYXJkLmNvbnN0cnVjdG9yIiwiVXBkYXRlTGVhZGVyYm9hcmQuYnVpbGQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7SUFBQSxpQkFBQTtBQUlFQSxhQUpGLGlCQUFBLENBSWNBLFdBQVdBLEVBQUVBLFFBQVFBLEVBQUFBOzhCQUpuQyxpQkFBQTs7QUFLSUMsWUFBSUEsQ0FBQ0EsV0FBV0EsR0FBR0EsV0FBV0EsQ0FBQ0E7QUFDL0JBLFlBQUlBLENBQUNBLFFBQVFBLEdBQUdBLFFBQVFBLENBQUNBO0tBQzFCQTs7aUJBUEgsaUJBQUE7O2VBU09ELGlCQUFBQTtBQUVIRSxnQkFBSUEsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0E7QUFDMUJBLGdCQUFJQSxVQUFVQSxHQUFHQSxDQUFDQSxDQUFDQTtBQUNuQkEsZ0JBQUlBLGFBQWFBLEdBQUdBLENBQUNBLENBQUNBO0FBRXRCQSxvQkFBUUEsSUFBSUEsQ0FBQ0EsUUFBUUE7QUFDbkJBLHFCQUFLQSxFQUFFQTtBQUVMQSx5QkFBS0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUE7QUFDbENBLDRCQUFJQSxPQUFPQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxXQUFXQSxFQUFFQTtBQUMvQkEscUNBQVNBO3lCQUNWQTtBQUVEQSw0QkFBSUEsSUFBSUEsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7QUFDakJBLGtDQUFVQSxJQUFJQSxDQUFDQSxDQUFDQTtBQUNoQkEsa0NBQVVBLElBQUlBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUVBO0FBQy9CQSxrQ0FBVUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7QUFFaEJBLHFDQUFh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b250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVwZGF0ZUxlYWRlcmJvYXJke1xuICBsZWFkZXJib2FyZDogYW55O1xuICBwYWNrZXRMQjogYW55O1xuXG4gIGNvbnN0cnVjdG9yKGxlYWRlcmJvYXJkLCBwYWNrZXRMQikge1xuICAgIHRoaXMubGVhZGVyYm9hcmQgPSBsZWFkZXJib2FyZDtcbiAgICB0aGlzLnBhY2tldExCID0gcGFja2V0TEI7XG4gIH1cblxuICBidWlsZCgpIHtcbiAgICAvLyBGaXJzdCwgY2FsY3VsYXRlIHRoZSBzaXplXG4gICAgdmFyIGxiID0gdGhpcy5sZWFkZXJib2FyZDtcbiAgICB2YXIgYnVmZmVyU2l6ZSA9IDU7XG4gICAgdmFyIHZhbGlkRWxlbWVudHMgPSAwO1xuXG4gICAgc3dpdGNoICh0aGlzLnBhY2tldExCKSB7XG4gICAgICBjYXNlIDQ4OiAvLyBDdXN0b20gVGV4dCBMaXN0XG4gICAgICAgIC8vIEdldCBzaXplIG9mIHBhY2tldFxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxiLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBsYltpXSA9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgaXRlbSA9IGxiW2ldO1xuICAgICAgICAgIGJ1ZmZlclNpemUgKz0gNDsgLy8gRW1wdHkgSURcbiAgICAgICAgICBidWZmZXJTaXplICs9IGl0ZW0ubGVuZ3RoICogMiA7IC8vIFN0cmluZyBsZW5ndGhcbiAgICAgICAgICBidWZmZXJTaXplICs9IDI7IC8vIE5hbWUgdGVybWluYXRvclxuXG4gICAgICAgICAgdmFsaWRFbGVtZW50cysrO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcihidWZmZXJTaXplKTtcbiAgICAgICAgdmFyIHZpZXcgPSBuZXcgRGF0YVZpZXcoYnVmKTtcblxuICAgICAgICAvLyBTZXQgcGFja2V0IGRhdGFcbiAgICAgICAgdmlldy5zZXRVaW50OCgwLCA0OSk7IC8vIFBhY2tldCBJRFxuICAgICAgICB2aWV3LnNldFVpbnQzMigxLCB2YWxpZEVsZW1lbnRzLCB0cnVlKTsgLy8gTnVtYmVyIG9mIGVsZW1lbnRzXG4gICAgICAgIHZhciBvZmZzZXQgPSA1O1xuXG4gICAgICAgIC8vIExvb3AgdGhyb3VnaCBzdHJpbmdzXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAodHlwZW9mIGxiW2ldID09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHZhciBpdGVtID0gbGJbaV07XG5cbiAgICAgICAgICB2aWV3LnNldFVpbnQzMihvZmZzZXQsIDEsIHRydWUpO1xuICAgICAgICAgIG9mZnNldCArPSA0O1xuXG4gICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBpdGVtLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICB2aWV3LnNldFVpbnQxNihvZmZzZXQsIGl0ZW0uY2hhckNvZGVBdChqKSwgdHJ1ZSk7XG4gICAgICAgICAgICBvZmZzZXQgKz0gMjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2aWV3LnNldFVpbnQxNihvZmZzZXQsIDAsIHRydWUpO1xuICAgICAgICAgIG9mZnNldCArPSAyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBidWY7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OTogLy8gRkZBLXR5cGUgUGFja2V0IChMaXN0KVxuICAgICAgICAvLyBHZXQgc2l6ZSBvZiBwYWNrZXRcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsYi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmICh0eXBlb2YgbGJbaV0gPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIGl0ZW0gPSBsYltpXTtcbiAgICAgICAgICBidWZmZXJTaXplICs9IDQ7IC8vIEVsZW1lbnQgSURcbiAgICAgICAgICBidWZmZXJTaXplICs9IGl0ZW0uZ2V0TmFtZSgpID8gaXRlbS5nZXROYW1lKCkubGVuZ3RoICogMiA6IDA7IC8vIE5hbWVcbiAgICAgICAgICBidWZmZXJTaXplICs9IDI7IC8vIE5hbWUgdGVybWluYXRvclxuXG4gICAgICAgICAgdmFsaWRFbGVtZW50cysrO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcihidWZmZXJTaXplKTtcbiAgICAgICAgdmFyIHZpZXcgPSBuZXcgRGF0YVZpZXcoYnVmKTtcblxuICAgICAgICAvLyBTZXQgcGFja2V0IGRhdGFcbiAgICAgICAgdmlldy5zZXRVaW50OCgwLCB0aGlzLnBhY2tldExCKTsgLy8gUGFja2V0IElEXG4gICAgICAgIHZpZXcuc2V0VWludDMyKDEsIHZhbGlkRWxlbWVudHMsIHRydWUpOyAvLyBOdW1iZXIgb2YgZWxlbWVudHNcblxuICAgICAgICB2YXIgb2Zmc2V0ID0gNTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsYi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmICh0eXBlb2YgbGJbaV0gPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIGl0ZW0gPSBsYltpXTtcblxuICAgICAgICAgIHZhciBub2RlSUQgPSAwOyAvLyBHZXQgbm9kZSBpZCBvZiBwbGF5ZXIncyAxc3QgY2VsbFxuICAgICAgICAgIGlmIChpdGVtLmNlbGxzWzBdKSB7XG4gICAgICAgICAgICBub2RlSUQgPSBpdGVtLmNlbGxzWzBdLm5vZGVJZDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2aWV3LnNldFVpbnQzMihvZmZzZXQsIG5vZGVJRCwgdHJ1ZSk7XG4gICAgICAgICAgb2Zmc2V0ICs9IDQ7XG5cbiAgICAgICAgICAvLyBTZXQgbmFtZVxuICAgICAgICAgIHZhciBuYW1lID0gaXRlbS5nZXROYW1lKCk7XG4gICAgICAgICAgaWYgKG5hbWUpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbmFtZS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICB2aWV3LnNldFVpbnQxNihvZmZzZXQsIG5hbWUuY2hhckNvZGVBdChqKSwgdHJ1ZSk7XG4gICAgICAgICAgICAgIG9mZnNldCArPSAyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHZpZXcuc2V0VWludDE2KG9mZnNldCwgMCwgdHJ1ZSk7XG4gICAgICAgICAgb2Zmc2V0ICs9IDI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJ1ZjtcbiAgICAgIGNhc2UgNTA6IC8vIFRlYW1zLXR5cGUgUGFja2V0IChQaWUgQ2hhcnQpXG4gICAgICAgIHZhbGlkRWxlbWVudHMgPSBsYi5sZW5ndGg7XG4gICAgICAgIGJ1ZmZlclNpemUgKz0gKHZhbGlkRWxlbWVudHMgKiA0KTtcblxuICAgICAgICB2YXIgYnVmID0gbmV3IEFycmF5QnVmZmVyKGJ1ZmZlclNpemUpO1xuICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhidWYpO1xuXG4gICAgICAgIHZpZXcuc2V0VWludDgoMCwgdGhpcy5wYWNrZXRMQik7IC8vIFBhY2tldCBJRFxuICAgICAgICB2aWV3LnNldFVpbnQzMigxLCB2YWxpZEVsZW1lbnRzLCB0cnVlKTsgLy8gTnVtYmVyIG9mIGVsZW1lbnRzXG5cbiAgICAgICAgdmFyIG9mZnNldCA9IDU7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsaWRFbGVtZW50cztpKyspIHtcbiAgICAgICAgICB2aWV3LnNldEZsb2F0MzIob2Zmc2V0LCBsYltpXSwgdHJ1ZSk7IC8vIE51bWJlciBvZiBlbGVtZW50c1xuICAgICAgICAgIG9mZnNldCArPSA0O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGJ1ZjtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfTtcblxufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj["default"] = obj; return newObj; } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var _packetIndex = require('./packet/index');

var Packet = _interopRequireWildcard(_packetIndex);

var PlayerTracker = (function () {
    function PlayerTracker(gameServer, socket) {
        _classCallCheck(this, PlayerTracker);

        this.pID = -1;
        this.disconnect = -1;
        this.name = "";
        this.gameServer = gameServer;
        this.socket = socket;
        this.nodeAdditionQueue = [];
        this.nodeDestroyQueue = [];
        this.visibleNodes = [];
        this.cells = [];
        this.score = 0;
        this.mouse = { x: 0, y: 0 };
        this.mouseCells = [];
        this.tickLeaderboard = 0;
        this.tickViewBox = 0;
        this.team = 0;
        this.spectate = false;
        this.spectatedPlayer = -1;
        this.sightRangeX = 0;
        this.sightRangeY = 0;
        this.centerPos = { x: 3000, y: 3000 };
        this.viewBox = {
            topY: 0,
            bottomY: 0,
            leftX: 0,
            rightX: 0,
            width: 0,
            height: 0
        };
        if (gameServer) {
            this.pID = gameServer.getNewPlayerID();
            gameServer.gameMode.onPlayerInit(this);
        }
    }

    _createClass(PlayerTracker, [{
        key: "setName",
        value: function setName(name) {
            this.name = name;
        }
    }, {
        key: "getName",
        value: function getName() {
            return this.name;
        }
    }, {
        key: "getScore",
        value: function getScore(reCalcScore) {
            if (reCalcScore) {
                var s = 0;
                for (var i = 0; i < this.cells.length; i++) {
                    s += this.cells[i].mass;
                    this.score = s;
                }
            }
            return this.score >> 0;
        }
    }, {
        key: "setColor",
        value: function setColor(color) {
            this.color.r = color.r;
            this.color.b = color.b;
            this.color.g = color.g;
        }
    }, {
        key: "getTeam",
        value: function getTeam() {
            return this.team;
        }
    }, {
        key: "update",
        value: function update() {
            if (this.socket.packetHandler.pressSpace) {
                this.gameServer.gameMode.pressSpace(this.gameServer, this);
                this.socket.packetHandler.pressSpace = false;
            }
            if (this.socket.packetHandler.pressW) {
                this.gameServer.gameMode.pressW(this.gameServer, this);
                this.socket.packetHandler.pressW = false;
            }
            if (this.socket.packetHandler.pressQ) {
                this.gameServer.gameMode.pressQ(this.gameServer, this);
                this.socket.packetHandler.pressQ = false;
            }
            var updateNodes = [];
            var d = 0;
            while (d < this.nodeDestroyQueue.length) {
                var index = this.visibleNodes.indexOf(this.nodeDestroyQueue[d]);
                if (index > -1) {
                    this.visibleNodes.splice(index, 1);
                    d++;
                } else {
                    this.nodeDestroyQueue.splice(d, 1);
                }
            }
            var nonVisibleNodes = [];
            if (this.tickViewBox <= 0) {
                var newVisible = this.calcViewBox();
                for (var i = 0; i < this.visibleNodes.length; i++) {
                    var index = newVisible.indexOf(this.visibleNodes[i]);
                    if (index == -1) {
                        nonVisibleNodes.push(this.visibleNodes[i]);
                    }
                }
                for (var i = 0; i < newVisible.length; i++) {
                    var index = this.visibleNodes.indexOf(newVisible[i]);
                    if (index == -1) {
                        updateNodes.push(newVisible[i]);
                    }
                }
                this.visibleNodes = newVisible;
                this.tickViewBox = 2;
            } else {
                this.tickViewBox--;
                for (var i = 0; i < this.nodeAdditionQueue.length; i++) {
                    var node = this.nodeAdditionQueue[i];
                    this.visibleNodes.push(node);
                    updateNodes.push(node);
                }
            }
            for (var i = 0; i < this.visibleNodes.length; i++) {
                var node = this.visibleNodes[i];
                if (node.sendUpdate()) {
                    updateNodes.push(node);
                }
            }
            this.socket.sendPacket(new Packet.UpdateNodes(this.nodeDestroyQueue, updateNodes, nonVisibleNodes));
            this.nodeDestroyQueue = [];
            this.nodeAdditionQueue = [];
            if (this.tickLeaderboard <= 0) {
                this.socket.sendPacket(this.gameServer.lb_packet);
                this.tickLeaderboard = 10;
            } else {
                this.tickLeaderboard--;
            }
            if (this.disconnect > -1) {
                this.disconnect--;
                if (this.disconnect == -1) {
                    var len = this.cells.length;
                    for (var i = 0; i < len; i++) {
                        var cell = this.socket.playerTracker.cells[0];
                        if (!cell) {
                            continue;
                        }
                        this.gameServer.removeNode(cell);
                    }
                    var index = this.gameServer.clients.indexOf(this.socket);
                    if (index != -1) {
                        this.gameServer.clients.splice(index, 1);
                    }
                }
            }
        }
    }, {
        key: "updateSightRange",
        value: function updateSightRange() {
            var totalSize = 1.0;
            var len = this.cells.length;
            for (var i = 0; i < len; i++) {
                if (!this.cells[i]) {
                    continue;
                }
                totalSize += this.cells[i].getSize();
            }
            var factor = Math.pow(Math.min(64.0 / totalSize, 1), 0.4);
            this.sightRangeX = this.gameServer.config.serverViewBaseX / factor;
            this.sightRangeY = this.gameServer.config.serverViewBaseY / factor;
        }
    }, {
        key: "updateCenter",
        value: function updateCenter() {
            var len = this.cells.length;
            if (len <= 0) {
                return;
            }
            var X = 0;
            var Y = 0;
            for (var i = 0; i < len; i++) {
                if (!this.cells[i]) {
                    continue;
                }
                X += this.cells[i].position.x;
                Y += this.cells[i].position.y;
            }
            this.centerPos.x = X / len;
            this.centerPos.y = Y / len;
        }
    }, {
        key: "calcViewBox",
        value: function calcViewBox() {
            if (this.spectate) {
                return this.getSpectateNodes();
            }
            this.updateSightRange();
            this.updateCenter();
            this.viewBox.topY = this.centerPos.y - this.sightRangeY;
            this.viewBox.bottomY = this.centerPos.y + this.sightRangeY;
            this.viewBox.leftX = this.centerPos.x - this.sightRangeX;
            this.viewBox.rightX = this.centerPos.x + this.sightRangeX;
            this.viewBox.width = this.sightRangeX;
            this.viewBox.height = this.sightRangeY;
            var newVisible = [];
            for (var i = 0; i < this.gameServer.nodes.length; i++) {
                var node = this.gameServer.nodes[i];
                if (!node) {
                    continue;
                }
                if (node.visibleCheck(this.viewBox, this.centerPos)) {
                    newVisible.push(node);
                }
            }
            return newVisible;
        }
    }, {
        key: "getSpectateNodes",
        value: function getSpectateNodes() {
            var specPlayer;
            if (this.gameServer.getMode().specByLeaderboard) {
                this.spectatedPlayer = Math.min(this.gameServer.leaderboard.length - 1, this.spectatedPlayer);
                specPlayer = this.spectatedPlayer == -1 ? null : this.gameServer.leaderboard[this.spectatedPlayer];
            } else {
                this.spectatedPlayer = Math.min(this.gameServer.clients.length - 1, this.spectatedPlayer);
                specPlayer = this.spectatedPlayer == -1 ? null : this.gameServer.clients[this.spectatedPlayer].playerTracker;
            }
            if (specPlayer) {
                if (specPlayer.cells.length == 0) {
                    this.gameServer.switchSpectator(this);
                    return [];
                }
                var specZoom = Math.sqrt(100 * specPlayer.score);
                specZoom = Math.pow(Math.min(40.5 / specZoom, 1.0), 0.4) * 0.6;
                this.socket.sendPacket(new Packet.UpdatePosition(specPlayer.centerPos.x, specPlayer.centerPos.y, specZoom));
                return specPlayer.visibleNodes.slice(0, specPlayer.visibleNodes.length);
            } else {
                return [];
            }
        }
    }]);

    return PlayerTracker;
})();

exports["default"] = PlayerTracker;
module.exports = exports["default"];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlBsYXllclRyYWNrZXIudHMiXSwibmFtZXMiOlsiUGxheWVyVHJhY2tlciIsIlBsYXllclRyYWNrZXIuY29uc3RydWN0b3IiLCJQbGF5ZXJUcmFja2VyLnNldE5hbWUiLCJQbGF5ZXJUcmFja2VyLmdldE5hbWUiLCJQbGF5ZXJUcmFja2VyLmdldFNjb3JlIiwiUGxheWVyVHJhY2tlci5zZXRDb2xvciIsIlBsYXllclRyYWNrZXIuZ2V0VGVhbSIsIlBsYXllclRyYWNrZXIudXBkYXRlIiwiUGxheWVyVHJhY2tlci51cGRhdGVTaWdodFJhbmdlIiwiUGxheWVyVHJhY2tlci51cGRhdGVDZW50ZXIiLCJQbGF5ZXJUcmFja2VyLmNhbGNWaWV3Qm94IiwiUGxheWVyVHJhY2tlci5nZXRTcGVjdGF0ZU5vZGVzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7MkJBQXdCLGdCQUFnQjs7SUFBNUIsTUFBTTs7SUFLbEIsYUFBQTtBQThCRUEsYUE5QkYsYUFBQSxDQThCY0EsVUFBVUEsRUFBRUEsTUFBTUEsRUFBQUE7OEJBOUJoQyxhQUFBOztBQStCSUMsWUFBSUEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7QUFDZEEsWUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7QUFDckJBLFlBQUlBLENBQUNBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBO0FBQ2ZBLFlBQUlBLENBQUNBLFVBQVVBLEdBQUdBLFVBQVVBLENBQUNBO0FBQzdCQSxZQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxNQUFNQSxDQUFDQTtBQUNyQkEsWUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFHQSxFQUFFQSxDQUFDQTtBQUM1QkEsWUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxFQUFFQSxDQUFDQTtBQUMzQkEsWUFBSUEsQ0FBQ0EsWUFBWUEsR0FBR0EsRUFBRUEsQ0FBQ0E7QUFDdkJBLFlBQUlBLENBQUNBLEtBQUtBLEdBQUdBLEVBQUVBLENBQUNBO0FBQ2hCQSxZ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QUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxDQUFDQSxhQUFhQSxDQUFDQTthQUM5R0E7QUFFREEsZ0JBQUlBLFVBQVVBLEVBQUVBO0FBRWRBLG9CQUFJQSxVQUFVQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxDQUFDQSxFQUFFQTtBQUNoQ0Esd0JBQUlBLENBQUNBLFVBQVVBLENBQUNBLGVBQWVBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO0FBQ3RDQSwyQkFBT0EsRUFBRUEsQ0FBQ0E7aUJBQ1hBO0FBR0RBLG9CQUFJQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxHQUFHQSxVQUFVQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtBQUNqREEsd0JBQVFBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLEdBQUdBLFFBQVFBLEVBQUVBLEdBQUdBLENBQUNBLEVBQUVBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBO0FBRS9EQSxvQkFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsSUFBSUEsTUFBTUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsVUFBVUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7QUFFNUdBLHVCQUFPQSxVQUFVQSxDQUFDQSxZQUFZQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxFQUFDQSxVQUFVQSxDQUFDQSxZQUFZQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTthQUN4RUEsTUFBTUE7QUFDTEEsdUJBQU9BLEVBQUVBLENBQUNBO2FBQ1hBO1NBQ0ZBOzs7V0F2VUgsYUFBQTs7O3FCQUFBLGFBQUEiLCJmaWxlIjoiUGxheWVyVHJhY2tlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFBhY2tldCBmcm9tICcuL3BhY2tldC9pbmRleCc7XG5pbXBvcnQgR2FtZVNlcnZlciBmcm9tICcuL0dhbWVTZXJ2ZXInO1xuXG5pbXBvcnQge1ZpZXdCb3gsIFBvc2l0aW9uLCBDb2xvcn0gZnJvbSAnLi9IZWxwZXJEZWZzL2luZGV4JztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGxheWVyVHJhY2tlcntcbiAgcElEOiBudW1iZXI7XG4gIGRpc2Nvbm5lY3Q6IG51bWJlcjtcbiAgbmFtZTogc3RyaW5nO1xuICBnYW1lU2VydmVyOiBHYW1lU2VydmVyO1xuICBzb2NrZXQ6IGFueTtcbiAgbm9kZUFkZGl0aW9uUXVldWU6IGFueVtdO1xuICBub2RlRGVzdHJveVF1ZXVlOiBhbnlbXTtcbiAgdmlzaWJsZU5vZGVzOiBhbnlbXTtcbiAgY2VsbHM6IGFueVtdO1xuICAvLyBmb3IgbGVhZGVyYm9hcmRcbiAgc2NvcmU6IG51bWJlclxuXG4gIG1vdXNlOiBQb3NpdGlvbjtcbiAgbW91c2VDZWxsczogYW55W107IC8vIEZvciBpbmRpdmlkdWFsIGNlbGwgbW92ZW1lbnRcbiAgdGlja0xlYWRlcmJvYXJkOiBudW1iZXI7XG4gIHRpY2tWaWV3Qm94OiBudW1iZXI7XG5cbiAgY29sb3I6IENvbG9yO1xuXG4gIHRlYW06IG51bWJlcjtcbiAgc3BlY3RhdGU6IGJvb2xlYW47XG4gIC8vIEN1cnJlbnQgcGxheWVyIHRoYXQgdGhpcyBwbGF5ZXIgaXMgd2F0Y2hpbmdcbiAgc3BlY3RhdGVkUGxheWVyOiBudW1iZXI7XG5cbiAgc2lnaHRSYW5nZVg6IG51bWJlcjtcbiAgc2lnaHRSYW5nZVk6IG51bWJlcjtcbiAgY2VudGVyUG9zOiBQb3NpdGlvbjtcbiAgdmlld0JveDogVmlld0JveDtcblxuICBjb25zdHJ1Y3RvcihnYW1lU2VydmVyLCBzb2NrZXQpIHtcbiAgICB0aGlzLnBJRCA9IC0xO1xuICAgIHRoaXMuZGlzY29ubmVjdCA9IC0xOyAvLyBEaXNjb25uZWN0aW9uXG4gICAgdGhpcy5uYW1lID0gXCJcIjtcbiAgICB0aGlzLmdhbWVTZXJ2ZXIgPSBnYW1lU2VydmVyO1xuICAgIHRoaXMuc29ja2V0ID0gc29ja2V0O1xuICAgIHRoaXMubm9kZUFkZGl0aW9uUXVldWUgPSBbXTtcbiAgICB0aGlzLm5vZGVEZXN0cm95UXVldWUgPSBbXTtcbiAgICB0aGlzLnZpc2libGVOb2RlcyA9IFtdO1xuICAgIHRoaXMuY2VsbHMgPSBbXTtcbiAgICB0aGlzLnNjb3JlID0gMDsgLy8gTmVlZGVkIGZvciBsZWFkZXJib2FyZFxuXG4gICAgdGhpcy5tb3VzZSA9IHt4OiAwLCB5OiAwfTtcbiAgICB0aGlzLm1vdXNlQ2VsbHMgPSBbXTsgLy8gRm9yIGluZGl2aWR1YWwgY2VsbCBtb3ZlbWVudFxuICAgIHRoaXMudGlja0xlYWRlcmJvYXJkID0gMDsgLy9cbiAgICB0aGlzLnRpY2tWaWV3Qm94ID0gMDtcblxuICAgIHRoaXMudGVhbSA9IDA7XG4gICAgdGhpcy5zcGVjdGF0ZSA9IGZhbHNlO1xuICAgIHRoaXMuc3BlY3RhdGVkUGxheWVyID0gLTE7IC8vIEN1cnJlbnQgcGxheWVyIHRoYXQgdGhpcyBwbGF5ZXIgaXMgd2F0Y2hpbmdcblxuICAgIC8vIFZpZXdpbmcgYm94XG4gICAgdGhpcy5zaWdodFJhbmdlWCA9IDA7XG4gICAgdGhpcy5zaWdodFJhbmdlWSA9IDA7XG4gICAgdGhpcy5jZW50ZXJQb3MgPSB7eDogMzAwMCwgeTogMzAwMCB9O1xuICAgIHRoaXMudmlld0JveCA9IHtcbiAgICAgIHRvcFk6IDAsXG4gICAgICBib3R0b21ZOiAwLFxuICAgICAgbGVmdFg6IDAsXG4gICAgICByaWdodFg6IDAsXG4gICAgICB3aWR0aDogMCwgLy8gSGFsZi13aWR0aFxuICAgICAgaGVpZ2h0OiAwIC8vIEhhbGYtaGVpZ2h0XG4gICAgfTtcblxuICAgIC8vIEdhbWVtb2RlIGZ1bmN0aW9uXG4gICAgaWYgKGdhbWVTZXJ2ZXIpIHtcbiAgICAgIHRoaXMucElEID0gZ2FtZVNlcnZlci5nZXROZXdQbGF5ZXJJRCgpO1xuICAgICAgZ2FtZVNlcnZlci5nYW1lTW9kZS5vblBsYXllckluaXQodGhpcyk7XG4gICAgfVxuICB9XG5cbiAgLy8gU2V0dGVycy9HZXR0ZXJzXG5cbiAgc2V0TmFtZShuYW1lKSB7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgfTtcblxuICBnZXROYW1lKCkge1xuICAgIHJldHVybiB0aGlzLm5hbWU7XG4gIH07XG5cbiAgZ2V0U2NvcmUocmVDYWxjU2NvcmUpIHtcbiAgICBpZiAocmVDYWxjU2NvcmUpIHtcbiAgICAgIHZhciBzID0gMDtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jZWxscy5sZW5ndGg7IGkrKykge1xuICAgICAgICBzICs9IHRoaXMuY2VsbHNbaV0ubWFzcztcbiAgICAgICAgdGhpcy5zY29yZSA9IHM7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnNjb3JlID4+IDA7XG4gIH07XG5cbiAgLy8gVE9ETywgbm90IHN1cmUgaWYgdGhpcyBpcyBhY3R1YWxseSB1c2VkXG4gIHNldENvbG9yKGNvbG9yKSB7XG4gICAgdGhpcy5jb2xvci5yID0gY29sb3IucjtcbiAgICB0aGlzLmNvbG9yLmIgPSBjb2xvci5iO1xuICAgIHRoaXMuY29sb3IuZyA9IGNvbG9yLmc7XG4gIH07XG5cbiAgZ2V0VGVhbSgpIHtcbiAgICByZXR1cm4gdGhpcy50ZWFtO1xuICB9O1xuXG4gIC8vIEZ1bmN0aW9uc1xuXG4gIHVwZGF0ZSgpIHtcbiAgICAvLyBBY3Rpb25zIGJ1ZmZlciAoU28gdGhhdCBwZW9wbGUgY2FudCBzcGFtIHBhY2tldHMpXG4gICAgLy8gU3BsaXQgY2VsbFxuICAgIGlmICh0aGlzLnNvY2tldC5wYWNrZXRIYW5kbGVyLnByZXNzU3BhY2UpIHtcbiAgICAgIHRoaXMuZ2FtZVNlcnZlci5nYW1lTW9kZS5wcmVzc1NwYWNlKHRoaXMuZ2FtZVNlcnZlciwgdGhpcyk7XG4gICAgICB0aGlzLnNvY2tldC5wYWNrZXRIYW5kbGVyLnByZXNzU3BhY2UgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBFamVjdCBtYXNzXG4gICAgaWYgKHRoaXMuc29ja2V0LnBhY2tldEhhbmRsZXIucHJlc3NXKSB7XG4gICAgICB0aGlzLmdhbWVTZXJ2ZXIuZ2FtZU1vZGUucHJlc3NXKHRoaXMuZ2FtZVNlcnZlciwgdGhpcyk7XG4gICAgICB0aGlzLnNvY2tldC5wYWNrZXRIYW5kbGVyLnByZXNzVyA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8vIFEgUHJlc3NcbiAgICBpZiAodGhpcy5zb2NrZXQucGFja2V0SGFuZGxlci5wcmVzc1EpIHtcbiAgICAgIHRoaXMuZ2FtZVNlcnZlci5nYW1lTW9kZS5wcmVzc1EodGhpcy5nYW1lU2VydmVyLCB0aGlzKTtcbiAgICAgIHRoaXMuc29ja2V0LnBhY2tldEhhbmRsZXIucHJlc3NRID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIHVwZGF0ZU5vZGVzID0gW107IC8vIE5vZGVzIHRoYXQgbmVlZCB0byBiZSB1cGRhdGVkIHZpYSBwYWNrZXRcblxuICAgIC8vIFJlbW92ZSBub2RlcyBmcm9tIHZpc2libGUgbm9kZXMgaWYgcG9zc2libGVcbiAgICB2YXIgZCA9IDA7XG4gICAgd2hpbGUgKGQgPCB0aGlzLm5vZGVEZXN0cm95UXVldWUubGVuZ3RoKSB7XG4gICAgICB2YXIgaW5kZXggPSB0aGlzLnZpc2libGVOb2Rlcy5pbmRleE9mKHRoaXMubm9kZURlc3Ryb3lRdWV1ZVtkXSk7XG4gICAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgICB0aGlzLnZpc2libGVOb2Rlcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICBkKys7IC8vIEluY3JlbWVudFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gTm9kZSB3YXMgbmV2ZXIgdmlzaWJsZSBhbnl3YXlzXG4gICAgICAgIHRoaXMubm9kZURlc3Ryb3lRdWV1ZS5zcGxpY2UoZCwxKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBHZXQgdmlzaWJsZSBub2RlcyBldmVyeSA0MDAgbXNcbiAgICB2YXIgbm9uVmlzaWJsZU5vZGVzID0gW107IC8vIE5vZGVzIHRoYXQgYXJlIG5vdCB2aXNpYmxlXG4gICAgaWYgKHRoaXMudGlja1ZpZXdCb3ggPD0gMCkge1xuICAgICAgdmFyIG5ld1Zpc2libGUgPSB0aGlzLmNhbGNWaWV3Qm94KCk7XG5cbiAgICAgIC8vIENvbXBhcmUgYW5kIGRlc3Ryb3kgbm9kZXMgdGhhdCBhcmUgbm90IHNlZW5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy52aXNpYmxlTm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGluZGV4OiBudW1iZXIgPSBuZXdWaXNpYmxlLmluZGV4T2YodGhpcy52aXNpYmxlTm9kZXNbaV0pO1xuICAgICAgICBpZiAoaW5kZXggPT0gLTEpIHtcbiAgICAgICAgICAvLyBOb3Qgc2VlbiBieSB0aGUgY2xpZW50IGFueW1vcmVcbiAgICAgICAgICBub25WaXNpYmxlTm9kZXMucHVzaCh0aGlzLnZpc2libGVOb2Rlc1tpXSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQWRkIG5vZGVzIHRvIGNsaWVudCdzIHNjcmVlbiBpZiBjbGllbnQgaGFzIG5vdCBzZWVuIGl0IGFscmVhZHlcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmV3VmlzaWJsZS5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgaW5kZXggPSB0aGlzLnZpc2libGVOb2Rlcy5pbmRleE9mKG5ld1Zpc2libGVbaV0pO1xuICAgICAgICBpZiAoaW5kZXggPT0gLTEpIHtcbiAgICAgICAgICB1cGRhdGVOb2Rlcy5wdXNoKG5ld1Zpc2libGVbaV0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMudmlzaWJsZU5vZGVzID0gbmV3VmlzaWJsZTtcbiAgICAgIC8vIFJlc2V0IFRpY2tzXG4gICAgICB0aGlzLnRpY2tWaWV3Qm94ID0gMjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy50aWNrVmlld0JveC0tO1xuICAgICAgLy8gQWRkIG5vZGVzIHRvIHNjcmVlblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm5vZGVBZGRpdGlvblF1ZXVlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBub2RlID0gdGhpcy5ub2RlQWRkaXRpb25RdWV1ZVtpXTtcbiAgICAgICAgdGhpcy52aXNpYmxlTm9kZXMucHVzaChub2RlKTtcbiAgICAgICAgdXBkYXRlTm9kZXMucHVzaChub2RlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgbW92aW5nIG5vZGVzXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnZpc2libGVOb2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIG5vZGUgPSB0aGlzLnZpc2libGVOb2Rlc1tpXTtcbiAgICAgIGlmIChub2RlLnNlbmRVcGRhdGUoKSkge1xuICAgICAgICAvLyBTZW5kcyBhbiB1cGRhdGUgaWYgY2VsbCBpcyBtb3ZpbmdcbiAgICAgICAgdXBkYXRlTm9kZXMucHVzaChub2RlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTZW5kIHBhY2tldFxuICAgIHRoaXMuc29ja2V0LnNlbmRQYWNrZXQobmV3IFBhY2tldC5VcGRhdGVOb2Rlcyh0aGlzLm5vZGVEZXN0cm95UXVldWUsIHVwZGF0ZU5vZGVzLCBub25WaXNpYmxlTm9kZXMpKTtcblxuICAgIHRoaXMubm9kZURlc3Ryb3lRdWV1ZSA9IFtdOyAvLyBSZXNldCBkZXN0cm95IHF1ZXVlXG4gICAgdGhpcy5ub2RlQWRkaXRpb25RdWV1ZSA9IFtdOyAvLyBSZXNldCBhZGRpdGlvbiBxdWV1ZVxuXG4gICAgLy8gVXBkYXRlIGxlYWRlcmJvYXJkXG4gICAgaWYgKHRoaXMudGlja0xlYWRlcmJvYXJkIDw9IDApIHtcbiAgICAgIHRoaXMuc29ja2V0LnNlbmRQYWNrZXQodGhpcy5nYW1lU2VydmVyLmxiX3BhY2tldCk7XG4gICAgICB0aGlzLnRpY2tMZWFkZXJib2FyZCA9IDEwOyAvLyAyMCB0aWNrcyA9IDEgc2Vjb25kXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudGlja0xlYWRlcmJvYXJkLS07XG4gICAgfVxuXG4gICAgLy8gSGFuZGxlcyBkaXNjb25uZWN0aW9uc1xuICAgIGlmICh0aGlzLmRpc2Nvbm5lY3QgPiAtMSkge1xuICAgICAgLy8gUGxheWVyIGhhcyBkaXNjb25uZWN0ZWQuLi4gcmVtb3ZlIGl0IHdoZW4gdGhlIHRpbWVyIGhpdHMgLTFcbiAgICAgIHRoaXMuZGlzY29ubmVjdC0tO1xuICAgICAgaWYgKHRoaXMuZGlzY29ubmVjdCA9PSAtMSkge1xuICAgICAgICAvLyBSZW1vdmUgYWxsIGNsaWVudCBjZWxsc1xuICAgICAgICB2YXIgbGVuID0gdGhpcy5jZWxscy5sZW5ndGg7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICB2YXIgY2VsbCA9IHRoaXMuc29ja2V0LnBsYXllclRyYWNrZXIuY2VsbHNbMF07XG5cbiAgICAgICAgICBpZiAoIWNlbGwpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuZ2FtZVNlcnZlci5yZW1vdmVOb2RlKGNlbGwpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmVtb3ZlIGZyb20gY2xpZW50IGxpc3RcbiAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5nYW1lU2VydmVyLmNsaWVudHMuaW5kZXhPZih0aGlzLnNvY2tldCk7XG4gICAgICAgIGlmIChpbmRleCAhPSAtMSkge1xuICAgICAgICAgIHRoaXMuZ2FtZVNlcnZlci5jbGllbnRzLnNwbGljZShpbmRleCwxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvLyBWaWV3aW5nIGJveFxuXG4gIHVwZGF0ZVNpZ2h0UmFuZ2UoKSB7IC8vIEZvciB2aWV3IGRpc3RhbmNlXG4gICAgdmFyIHRvdGFsU2l6ZSA9IDEuMDtcbiAgICB2YXIgbGVuID0gdGhpcy5jZWxscy5sZW5ndGg7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjtpKyspIHtcbiAgICAgIGlmICghdGhpcy5jZWxsc1tpXSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgdG90YWxTaXplICs9IHRoaXMuY2VsbHNbaV0uZ2V0U2l6ZSgpO1xuICAgIH1cblxuICAgIHZhciBmYWN0b3IgPSBNYXRoLnBvdyhNYXRoLm1pbig2NC4wIC8gdG90YWxTaXplLCAxKSwgMC40KTtcbiAgICB0aGlzLnNpZ2h0UmFuZ2VYID0gdGhpcy5nYW1lU2VydmVyLmNvbmZpZy5zZXJ2ZXJWaWV3QmFzZVggLyBmYWN0b3I7XG4gICAgdGhpcy5zaWdodFJhbmdlWSA9IHRoaXMuZ2FtZVNlcnZlci5jb25maWcuc2VydmVyVmlld0Jhc2VZIC8gZmFjdG9yO1xuICB9O1xuXG4gIHVwZGF0ZUNlbnRlcigpIHsgLy8gR2V0IGNlbnRlciBvZiBjZWxsc1xuICAgIHZhciBsZW4gPSB0aGlzLmNlbGxzLmxlbmd0aDtcblxuICAgIGlmIChsZW4gPD0gMCkge1xuICAgICAgcmV0dXJuOyAvLyBFbmQgdGhlIGZ1bmN0aW9uIGlmIG5vIGNlbGxzIGV4aXN0XG4gICAgfVxuXG4gICAgdmFyIFggPSAwO1xuICAgIHZhciBZID0gMDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbiA7aSsrKSB7XG4gICAgICBpZiAoIXRoaXMuY2VsbHNbaV0pIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIFggKz0gdGhpcy5jZWxsc1tpXS5wb3NpdGlvbi54O1xuICAgICAgWSArPSB0aGlzLmNlbGxzW2ldLnBvc2l0aW9uLnk7XG4gICAgfVxuXG4gICAgdGhpcy5jZW50ZXJQb3MueCA9IFggLyBsZW47XG4gICAgdGhpcy5jZW50ZXJQb3MueSA9IFkgLyBsZW47XG4gIH07XG5cbiAgY2FsY1ZpZXdCb3goKSB7XG4gICAgaWYgKHRoaXMuc3BlY3RhdGUpIHtcbiAgICAgIC8vIFNwZWN0YXRlIG1vZGVcbiAgICAgIHJldHVybiB0aGlzLmdldFNwZWN0YXRlTm9kZXMoKTtcbiAgICB9XG5cbiAgICAvLyBNYWluIGZ1bmN0aW9uXG4gICAgdGhpcy51cGRhdGVTaWdodFJhbmdlKCk7XG4gICAgdGhpcy51cGRhdGVDZW50ZXIoKTtcblxuICAgIC8vIEJveFxuICAgIHRoaXMudmlld0JveC50b3BZID0gdGhpcy5jZW50ZXJQb3MueSAtIHRoaXMuc2lnaHRSYW5nZVk7XG4gICAgdGhpcy52aWV3Qm94LmJvdHRvbVkgPSB0aGlzLmNlbnRlclBvcy55ICsgdGhpcy5zaWdodFJhbmdlWTtcbiAgICB0aGlzLnZpZXdCb3gubGVmdFggPSB0aGlzLmNlbnRlclBvcy54IC0gdGhpcy5zaWdodFJhbmdlWDtcbiAgICB0aGlzLnZpZXdCb3gucmlnaHRYID0gdGhpcy5jZW50ZXJQb3MueCArIHRoaXMuc2lnaHRSYW5nZVg7XG4gICAgdGhpcy52aWV3Qm94LndpZHRoID0gdGhpcy5zaWdodFJhbmdlWDtcbiAgICB0aGlzLnZpZXdCb3guaGVpZ2h0ID0gdGhpcy5zaWdodFJhbmdlWTtcblxuICAgIHZhciBuZXdWaXNpYmxlID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmdhbWVTZXJ2ZXIubm9kZXMubGVuZ3RoIDtpKyspIHtcbiAgICAgIHZhciBub2RlID0gdGhpcy5nYW1lU2VydmVyLm5vZGVzW2ldO1xuXG4gICAgICBpZiAoIW5vZGUpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGlmIChub2RlLnZpc2libGVDaGVjayh0aGlzLnZpZXdCb3gsdGhpcy5jZW50ZXJQb3MpKSB7XG4gICAgICAgIC8vIENlbGwgaXMgaW4gcmFuZ2Ugb2Ygdmlld0JveFxuICAgICAgICBuZXdWaXNpYmxlLnB1c2gobm9kZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdWaXNpYmxlO1xuICB9O1xuXG4gIGdldFNwZWN0YXRlTm9kZXMoKSB7XG4gICAgdmFyIHNwZWNQbGF5ZXI7XG5cbiAgICBpZiAodGhpcy5nYW1lU2VydmVyLmdldE1vZGUoKS5zcGVjQnlMZWFkZXJib2FyZCkge1xuICAgICAgdGhpcy5zcGVjdGF0ZWRQbGF5ZXIgPSBNYXRoLm1pbih0aGlzLmdhbWVTZXJ2ZXIubGVhZGVyYm9hcmQubGVuZ3RoIC0gMSwgdGhpcy5zcGVjdGF0ZWRQbGF5ZXIpO1xuICAgICAgc3BlY1BsYXllciA9IHRoaXMuc3BlY3RhdGVkUGxheWVyID09IC0xID8gbnVsbCA6IHRoaXMuZ2FtZVNlcnZlci5sZWFkZXJib2FyZFt0aGlzLnNwZWN0YXRlZFBsYXllcl07XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3BlY3RhdGVkUGxheWVyID0gTWF0aC5taW4odGhpcy5nYW1lU2VydmVyLmNsaWVudHMubGVuZ3RoIC0gMSwgdGhpcy5zcGVjdGF0ZWRQbGF5ZXIpO1xuICAgICAgc3BlY1BsYXllciA9IHRoaXMuc3BlY3RhdGVkUGxheWVyID09IC0xID8gbnVsbCA6IHRoaXMuZ2FtZVNlcnZlci5jbGllbnRzW3RoaXMuc3BlY3RhdGVkUGxheWVyXS5wbGF5ZXJUcmFja2VyO1xuICAgIH1cblxuICAgIGlmIChzcGVjUGxheWVyKSB7XG4gICAgICAvLyBJZiBzZWxlY3RlZCBwbGF5ZXIgaGFzIGRpZWQvZGlzY29ubmVjdGVkLCBzd2l0Y2ggc3BlY3RhdG9yIGFuZCB0cnkgYWdhaW4gbmV4dCB0aWNrXG4gICAgICBpZiAoc3BlY1BsYXllci5jZWxscy5sZW5ndGggPT0gMCkge1xuICAgICAgICB0aGlzLmdhbWVTZXJ2ZXIuc3dpdGNoU3BlY3RhdG9yKHRoaXMpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCBzcGVjdGF0ZWQgcGxheWVyJ3MgbG9jYXRpb24gYW5kIGNhbGN1bGF0ZSB6b29tIGFtb3VudFxuICAgICAgdmFyIHNwZWNab29tID0gTWF0aC5zcXJ0KDEwMCAqIHNwZWNQbGF5ZXIuc2NvcmUpO1xuICAgICAgc3BlY1pvb20gPSBNYXRoLnBvdyhNYXRoLm1pbig0MC41IC8gc3BlY1pvb20sIDEuMCksIDAuNCkgKiAwLjY7XG4gICAgICAvLyBUT0RPOiBTZW5kIHBhY2tldCBlbHNld2hlcmUgc28gaXQgaXMgc2VuZCBtb3JlIG9mdGVuXG4gICAgICB0aGlzLnNvY2tldC5zZW5kUGFja2V0KG5ldyBQYWNrZXQuVXBkYXRlUG9zaXRpb24oc3BlY1BsYXllci5jZW50ZXJQb3MueCwgc3BlY1BsYXllci5jZW50ZXJQb3MueSwgc3BlY1pvb20pKTtcbiAgICAgIC8vIFRPRE86IFJlY2FsY3VsYXRlIHZpc2libGUgbm9kZXMgZm9yIHNwZWN0YXRvciB0byBtYXRjaCBzcGVjWm9vbVxuICAgICAgcmV0dXJuIHNwZWNQbGF5ZXIudmlzaWJsZU5vZGVzLnNsaWNlKDAsc3BlY1BsYXllci52aXNpYmxlTm9kZXMubGVuZ3RoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFtdOyAvLyBOb3RoaW5nXG4gICAgfVxuICB9O1xuXG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=